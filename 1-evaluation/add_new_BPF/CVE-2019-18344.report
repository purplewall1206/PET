[   39.185166] ------------[ cut here ]------------
[   39.185980] WARNING: CPU: 0 PID: 318 at drivers/media/common/videobuf2/videobuf2-core.c:1956 0
[   39.187884] Modules linked in:
[   39.188430] CPU: 0 PID: 318 Comm: poc Not tainted 5.15.0ebpf-detector+ #83
[   39.189617] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   39.191027] RIP: 0010:__vb2_queue_cancel+0x34c/0x3f0
[   39.191898] Code: ff 49 8b 45 58 48 85 c0 0f 84 5c ff ff ff 48 89 df e8 b8 da 8f 00 e9 4f ff 8
[   39.194642] RSP: 0018:ffff88800ab27d68 EFLAGS: 00010202
[   39.195397] RAX: 0000000000000001 RBX: ffffffff82ee6520 RCX: dffffc0000000000
[   39.196416] RDX: 0000000000000007 RSI: 0000000000000004 RDI: ffff8880093d716c
[   39.197440] RBP: ffff8880093d6f80 R08: ffffffff81f04b41 R09: ffff8880093d716f
[   39.198455] R10: ffffed100127ae2d R11: 0000000000000001 R12: ffff8880093d716c
[   39.199676] R13: ffff8880093d6f80 R14: ffff8880093d71a0 R15: ffff888008a6ee00
[   39.200992] FS:  00007f7f5f687700(0000) GS:ffff888027800000(0000) knlGS:0000000000000000
[   39.202467] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   39.203530] CR2: 00007f7f5f6f8000 CR3: 0000000009cc2000 CR4: 00000000000006f0
[   39.204487] Call Trace:
[   39.204645]  vb2_core_streamoff+0x27/0x90
[   39.204897]  __vb2_cleanup_fileio+0x39/0x90
[   39.205157]  vb2_core_queue_release+0x17/0x50
[   39.205437]  _vb2_fop_release+0xe8/0x110
[   39.205681]  ? vivid_remove+0x240/0x240
[   39.205922]  v4l2_release+0x116/0x190
[   39.206157]  __fput+0x10c/0x400
[   39.206367]  task_work_run+0x94/0xd0
[   39.206592]  exit_to_user_mode_prepare+0x177/0x180
[   39.206888]  syscall_exit_to_user_mode+0x23/0x40
[   39.207187]  do_syscall_64+0x48/0xc0
[   39.207416]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   39.207735] RIP: 0033:0x7f7f6087111b
[   39.207963] Code: 0f 05 48 3d 00 f0 ff ff 77 45 c3 0f 1f 40 00 48 83 ec 18 89 7c 24 0c e8 f3 4
[   39.209124] RSP: 002b:00007f7f5f686e10 EFLAGS: 00000293 ORIG_RAX: 0000000000000003
[   39.209596] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007f7f6087111b
[   39.210034] RDX: 00007f7f5f687700 RSI: 0000000000000000 RDI: 0000000000000004
[   39.210465] RBP: 00007f7f5f686ef0 R08: 0000000000000000 R09: 00007f7f5f686d07
[   39.210923] R10: 0000000000000001 R11: 0000000000000293 R12: 00007fff97fbd9fe
[   39.211377] R13: 00007fff97fbd9ff R14: 00007f7f5f686fc0 R15: 0000000000802000
[   39.211824] ---[ end trace ca52393ee1b12076 ]---
[   39.212116] videobuf2_common: driver bug: stop_streaming operation is leaving buf 00000000bace
[   39.213086] ==================================================================
[   39.213545] BUG: KASAN: use-after-free in vid_cap_buf_queue+0xa2/0xc0
[   39.213950] Write of size 8 at addr ffff88800be7aba8 by task poc/318
[   39.214348] 
[   39.214449] CPU: 0 PID: 318 Comm: poc Tainted: G        W         5.15.0ebpf-detector+ #83
[   39.214964] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   39.215482] Call Trace:
[   39.215642]  dump_stack_lvl+0x46/0x5a
[   39.215881]  print_address_description.constprop.0+0x1f/0x140
[   39.216246]  ? vid_cap_buf_queue+0xa2/0xc0
[   39.216509]  kasan_report.cold+0x7f/0x11b
[   39.216774]  ? vid_cap_buf_queue+0xa2/0xc0
[   39.217042]  vid_cap_buf_queue+0xa2/0xc0
[   39.217321]  vb2_start_streaming+0x3c/0x1d0
[   39.217686]  vb2_core_streamon+0xad/0x100
[   39.218002]  __vb2_init_fileio+0x42c/0x460
[   39.218263]  __vb2_perform_fileio+0x5d7/0x6a0
[   39.218541]  ? aa_path_link+0x1d0/0x1d0
[   39.218785]  ? vb2_core_poll+0x2c0/0x2c0
[   39.219039]  ? __mutex_lock_interruptible_slowpath+0x10/0x10
[   39.219394]  ? __fsnotify_update_child_dentry_flags+0x180/0x180
[   39.219765]  vb2_fop_read+0x111/0x1b0
[   39.219999]  v4l2_read+0x113/0x130
[   39.220218]  vfs_read+0xc0/0x250
[   39.220426]  ksys_read+0xb9/0x150
[   39.220644]  ? __ia32_sys_pwrite64+0x130/0x130
[   39.220925]  ? fpregs_assert_state_consistent+0x52/0x60
[   39.221246]  do_syscall_64+0x3b/0xc0
[   39.221474]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   39.221796] RIP: 0033:0x7f7f6087108c
[   39.222025] Code: ec 28 48 89 54 24 18 48 89 74 24 10 89 7c 24 08 e8 89 fc ff ff 48 8b 54 24 8
[   39.223182] RSP: 002b:00007f7f5f686e00 EFLAGS: 00000246 ORIG_RAX: 0000000000000000
[   39.223656] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f7f6087108c
[   39.224103] RDX: 0000000000fffded RSI: 00007f7f5f688000 RDI: 0000000000000003
[   39.224546] RBP: 00007f7f5f686ef0 R08: 0000000000000000 R09: 00007f7f5f686d07
[   39.224992] R10: 0000000000000000 R11: 0000000000000246 R12: 00007fff97fbd9fe
[   39.225433] R13: 00007fff97fbd9ff R14: 00007f7f5f686fc0 R15: 0000000000802000
[   39.225877] 
[   39.225976] Allocated by task 319:
[   39.226191]  kasan_save_stack+0x1b/0x40
[   39.226435]  __kasan_kmalloc+0xa4/0xd0
[   39.226672]  __vb2_queue_alloc+0xa6/0x690
[   39.226926]  vb2_core_reqbufs+0x3ca/0x5f0
[   39.227179]  __vb2_init_fileio+0x179/0x460
[   39.227438]  __vb2_perform_fileio+0x5d7/0x6a0
[   39.227712]  vb2_fop_read+0x111/0x1b0
[   39.227944]  v4l2_read+0x113/0x130
[   39.228160]  vfs_read+0xc0/0x250
[   39.228365]  ksys_read+0xb9/0x150
[   39.228579]  do_syscall_64+0x3b/0xc0
[   39.228805]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   39.229122] 
[   39.229221] Freed by task 318:
[   39.229416]  kasan_save_stack+0x1b/0x40
[   39.229660]  kasan_set_track+0x1c/0x30
[   39.229897]  kasan_set_free_info+0x20/0x30
[   39.230157]  ____kasan_slab_free+0x120/0x150
[   39.230425]  slab_free_freelist_hook+0x8e/0x180
[   39.230712]  kfree+0xc7/0x400
[   39.230903]  __vb2_queue_free+0x26f/0x360
[   39.231157]  vb2_core_reqbufs+0x130/0x5f0
[   39.231412]  __vb2_cleanup_fileio+0x72/0x90
[   39.231678]  vb2_core_queue_release+0x17/0x50
[   39.231952]  _vb2_fop_release+0xe8/0x110
[   39.232201]  v4l2_release+0x116/0x190
[   39.232432]  __fput+0x10c/0x400
[   39.232637]  task_work_run+0x94/0xd0
[   39.232864]  exit_to_user_mode_prepare+0x177/0x180
[   39.233165]  syscall_exit_to_user_mode+0x23/0x40
[   39.233456]  do_syscall_64+0x48/0xc0
[   39.233683]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   39.234001] 
[   39.234099] Last potentially related work creation:
[   39.234406]  kasan_save_stack+0x1b/0x40
[   39.234649]  kasan_record_aux_stack+0xbe/0xd0
[   39.234925]  insert_work+0x30/0x160
[   39.235148]  __queue_work+0x335/0x630
[   39.235381]  queue_work_on+0x59/0x80
[   39.235610]  tty_release_struct+0x86/0xa0
[   39.235865]  tty_release+0x685/0x850
[   39.236095]  __fput+0x10c/0x400
[   39.236296]  task_work_run+0x94/0xd0
[   39.236522]  exit_to_user_mode_prepare+0x177/0x180
[   39.236827]  syscall_exit_to_user_mode+0x23/0x40
[   39.237115]  do_syscall_64+0x48/0xc0
[   39.237342]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   39.237657] 
[   39.237756] The buggy address belongs to the object at ffff88800be7a800
[   39.237756]  which belongs to the cache kmalloc-1k of size 1024
[   39.238527] The buggy address is located 936 bytes inside of
[   39.238527]  1024-byte region [ffff88800be7a800, ffff88800be7ac00)
[   39.239252] The buggy address belongs to the page:
[   39.239551] page:000000004360dac0 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pf8
[   39.240120] head:000000004360dac0 order:3 compound_mapcount:0 compound_pincount:0
[   39.240588] flags: 0xfffffc0010200(slab|head|node=0|zone=1|lastcpupid=0x1fffff)
[   39.241049] raw: 000fffffc0010200 0000000000000000 0000000100000001 ffff888005841dc0
[   39.241532] raw: 0000000000000000 0000000000100010 00000001ffffffff 0000000000000000
[   39.242011] page dumped because: kasan: bad access detected
[   39.242361] 
[   39.242460] Memory state around the buggy address:
[   39.242760]  ffff88800be7aa80: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   39.243207]  ffff88800be7ab00: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   39.243655] >ffff88800be7ab80: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   39.244102]                                   ^
[   39.244387]  ffff88800be7ac00: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   39.244838]  ffff88800be7ac80: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   39.245286] ==================================================================
[   39.245733] Disabling lock debugging due to kernel taint
[   39.246601] BUG: kernel NULL pointer dereference, address: 0000000000000000
[   39.247041] #PF: supervisor write access in kernel mode
[   39.247368] #PF: error_code(0x0002) - not-present page
[   39.247687] PGD 0 P4D 0 
[   39.247851] Oops: 0002 [#1] SMP KASAN PTI
[   39.248105] CPU: 0 PID: 322 Comm: vivid-000-vid-c Tainted: G    B   W         5.15.0ebpf-dete3
[   39.248683] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   39.249199] RIP: 0010:memcpy_orig+0x29/0x10f
[   39.249469] Code: 00 48 89 f8 48 83 fa 20 72 7e 40 38 fe 7c 35 48 83 ea 20 48 83 ea 20 4c 8b 3
[   39.250615] RSP: 0018:ffff888009de7948 EFLAGS: 00010206
[   39.250944] RAX: 0000000000000000 RBX: 0000000000000001 RCX: ffffffff81eff0a1
[   39.251389] RDX: 00000000000004c0 RSI: ffffc90000261020 RDI: 0000000000000000
[   39.251832] RBP: ffffc90000261000 R08: 80b380b380b380b3 R09: 80b380b380b380b3
[   39.252274] R10: 80b380b380b380b3 R11: 80b380b380b380b3 R12: ffffc90000261000
[   39.252720] R13: 0000000000000000 R14: ffff8880093d68a0 R15: ffff8880093d68f8
[   39.253162] FS:  0000000000000000(0000) GS:ffff888027800000(0000) knlGS:0000000000000000
[   39.253662] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   39.254019] CR2: 0000000000000000 CR3: 0000000009cc2000 CR4: 00000000000006f0
[   39.254463] Call Trace:
[   39.254621]  tpg_fill_plane_buffer+0x791/0x1530
[   39.254912]  vivid_fillbuff+0xdf9/0x1a80
[   39.255162]  ? __update_load_avg_cfs_rq+0x1b0/0x5b0
[   39.255469]  ? vivid_copy_buffer+0x11a0/0x11a0
[   39.255749]  ? psi_group_change+0x3b3/0x4b0
[   39.256014]  ? psi_flags_change+0x53/0x70
[   39.256267]  ? iterate_groups+0x17/0xc0
[   39.256509]  ? psi_task_switch+0x2ae/0x2d0
[   39.256770]  ? _raw_spin_lock+0x7a/0xd0
[   39.257012]  ? _raw_write_lock_bh+0xe0/0xe0
[   39.257275]  ? vivid_thread_vid_cap_tick+0x56a/0xd10
[   39.257585]  vivid_thread_vid_cap_tick+0x56a/0xd10
[   39.257885]  ? mutex_lock+0x8e/0xe0
[   39.258106]  ? __mutex_lock_slowpath+0x10/0x10
[   39.258385]  vivid_thread_vid_cap+0x2db/0x490
[   39.258659]  ? vivid_thread_vid_cap_tick+0xd10/0xd10
[   39.258969]  kthread+0x1d2/0x200
[   39.259175]  ? set_kthread_struct+0x80/0x80
[   39.259438]  ret_from_fork+0x22/0x30
[   39.259667] Modules linked in:
[   39.259862] CR2: 0000000000000000
[   39.260072] ---[ end trace ca52393ee1b12077 ]---
[   39.260360] RIP: 0010:memcpy_orig+0x29/0x10f
[   39.260631] Code: 00 48 89 f8 48 83 fa 20 72 7e 40 38 fe 7c 35 48 83 ea 20 48 83 ea 20 4c 8b 3
[   39.261771] RSP: 0018:ffff888009de7948 EFLAGS: 00010206
[   39.262096] RAX: 0000000000000000 RBX: 0000000000000001 RCX: ffffffff81eff0a1
[   39.262534] RDX: 00000000000004c0 RSI: ffffc90000261020 RDI: 0000000000000000
[   39.262973] RBP: ffffc90000261000 R08: 80b380b380b380b3 R09: 80b380b380b380b3
[   39.263412] R10: 80b380b380b380b3 R11: 80b380b380b380b3 R12: ffffc90000261000
[   39.263853] R13: 0000000000000000 R14: ffff8880093d68a0 R15: ffff8880093d68f8
[   39.264294] FS:  0000000000000000(0000) GS:ffff888027800000(0000) knlGS:0000000000000000
[   39.264796] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   39.265140] CR2: 0000000000000000 CR3: 0000000009cc2000 CR4: 00000000000006f0