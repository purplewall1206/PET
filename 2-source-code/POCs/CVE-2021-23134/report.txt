[   27.106098] ==================================================================
[   27.106466] BUG: KASAN: use-after-free in _raw_write_lock+0x6b/0xd0
[   27.106866] Write of size 4 at addr ffff888008545240 by task poc/1136

[   27.107355] CPU: 0 PID: 1136 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   27.107798] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   27.108333] Call Trace:
[   27.108499]  dump_stack_lvl+0x34/0x44
[   27.108771]  print_address_description.constprop.0+0x21/0x140
[   27.109363]  ? _raw_write_lock+0x6b/0xd0
[   27.109733]  ? _raw_write_lock+0x6b/0xd0
[   27.110025]  kasan_report.cold+0x83/0xdf
[   27.110284]  ? _raw_write_lock+0x6b/0xd0
[   27.110550]  kasan_check_range+0x14e/0x1b0
[   27.110837]  _raw_write_lock+0x6b/0xd0
[   27.111093]  ? _raw_spin_lock_bh+0xe0/0xe0
[   27.111370]  ? locks_remove_posix+0x94/0x230
[   27.111626]  nfc_llcp_sock_unlink+0x1f/0xe0
[   27.111898]  llcp_sock_release+0xe8/0x2a0
[   27.112227]  __sock_release+0x72/0x120
[   27.112498]  sock_close+0x11/0x20
[   27.112739]  __fput+0x104/0x400
[   27.112979]  task_work_run+0x97/0xd0
[   27.113246]  exit_to_user_mode_prepare+0x14d/0x150
[   27.113591]  syscall_exit_to_user_mode+0x1d/0x40
[   27.113930]  do_syscall_64+0x48/0x90
[   27.114195]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   27.114558] RIP: 0033:0x7f237c83b6c3
[   27.114837] Code: e9 37 ff ff ff e8 4d e0 01 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 00 64 8b 04 25 18 00 00 00 85 c0 75 14 b8 03 00 00 00 0f 05 <48> 3d 00 f0 ff ff 8
[   27.116086] RSP: 002b:00007ffe0d675f88 EFLAGS: 00000246 ORIG_RAX: 0000000000000003
[   27.116480] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007f237c83b6c3
[   27.116863] RDX: 0000000000000000 RSI: 000055abe1ef92a0 RDI: 0000000000000004
[   27.117247] RBP: 00007ffe0d676000 R08: 000000000000000c R09: 00007f237c90abe0
[   27.117728] R10: 00007f237c937440 R11: 0000000000000246 R12: 000055abe1097090
[   27.118260] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000

[   27.118945] Allocated by task 1:
[   27.119230]  kasan_save_stack+0x1b/0x40
[   27.119537]  __kasan_kmalloc+0x7c/0x90
[   27.119746]  nfc_llcp_register_device+0x30/0x400
[   27.120005]  nfc_register_device+0x47/0xf0
[   27.120262]  nfcsim_device_new+0x1b1/0x31d
[   27.120515]  nfcsim_init+0x5d/0x10b
[   27.120701]  do_one_initcall+0x89/0x260
[   27.120891]  kernel_init_freeable+0x2b1/0x30a
[   27.121116]  kernel_init+0x19/0x130
[   27.121299]  ret_from_fork+0x22/0x30

[   27.121565] Freed by task 1136:
[   27.121729]  kasan_save_stack+0x1b/0x40
[   27.121945]  kasan_set_track+0x1c/0x30
[   27.122159]  kasan_set_free_info+0x20/0x30
[   27.122382]  __kasan_slab_free+0xea/0x120
[   27.122601]  kfree+0x90/0x220
[   27.122759]  nfc_llcp_local_put+0xc5/0xf0
[   27.122968]  llcp_sock_destruct+0x38/0x80
[   27.123178]  __sk_destruct+0x2f/0x260
[   27.123368]  llcp_sock_release+0x1c7/0x2a0
[   27.123575]  __sock_release+0x72/0x120
[   27.123767]  sock_close+0x11/0x20
[   27.123943]  __fput+0x104/0x400
[   27.124137]  task_work_run+0x97/0xd0
[   27.124328]  exit_to_user_mode_prepare+0x14d/0x150
[   27.124583]  syscall_exit_to_user_mode+0x1d/0x40
[   27.124827]  do_syscall_64+0x48/0x90
[   27.125017]  entry_SYSCALL_64_after_hwframe+0x44/0xae

[   27.125372] The buggy address belongs to the object at ffff888008545000
                which belongs to the cache kmalloc-1k of size 1024
[   27.126110] The buggy address is located 576 bytes inside of
                1024-byte region [ffff888008545000, ffff888008545400)
[   27.126700] The buggy address belongs to the page:
[   27.126937] page:000000002c1de1d2 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x8540
[   27.127413] head:000000002c1de1d2 order:3 compound_mapcount:0 compound_pincount:0
[   27.127817] flags: 0x100000000010200(slab|head|node=0|zone=1)
[   27.128134] raw: 0100000000010200 0000000000000000 dead000000000122 ffff888005841dc0
[   27.128533] raw: 0000000000000000 0000000000100010 00000001ffffffff 0000000000000000
[   27.128936] page dumped because: kasan: bad access detected

[   27.129313] Memory state around the buggy address:
[   27.129567]  ffff888008545100: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   27.129944]  ffff888008545180: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   27.130330] >ffff888008545200: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   27.130707]                                            ^
[   27.130991]  ffff888008545280: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   27.131418]  ffff888008545300: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   27.131873] ==================================================================
[   27.132350] Disabling lock debugging due to kernel taint