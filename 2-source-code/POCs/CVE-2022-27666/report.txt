[   35.059287] ==================================================================
[   35.060083] BUG: KASAN: use-after-free in null_skcipher_crypt+0x9c/0xf0
[   35.063609] Write of size 4096 at addr ffff888023958000 by task poc/1146
[   35.064303] 
[   35.064502] CPU: 0 PID: 1146 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   35.065253] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   35.066160] Call Trace:
[   35.066517]  dump_stack_lvl+0x34/0x44
[   35.067500]  print_address_description.constprop.0+0x21/0x140
[   35.069268]  ? null_skcipher_crypt+0x9c/0xf0
[   35.070572]  ? null_skcipher_crypt+0x9c/0xf0
[   35.071887]  kasan_report.cold+0x83/0xdf
[   35.072955]  ? null_skcipher_crypt+0x9c/0xf0
[   35.074099]  kasan_check_range+0x14e/0x1b0
[   35.075320]  memcpy+0x39/0x60
[   35.076048]  null_skcipher_crypt+0x9c/0xf0
[   35.077082]  ? null_compress+0x50/0x50
[   35.078384]  ? memset+0x20/0x40
[   35.079307]  ? sg_next+0x1c/0x40
[   35.080370]  ? scatterwalk_ffwd+0xf9/0x140
[   35.081594]  ? crypto_skcipher_encrypt+0x3d/0x60
[   35.083028]  crypto_authenc_encrypt+0x1bd/0x1f0
[   35.084210]  esp6_output_tail+0x35f/0x980
[   35.085446]  esp6_xmit+0x579/0x5f0
[   35.086248]  ? esp6_gso_encap+0x260/0x260
[   35.087638]  ? skb_csum_hwoffload_help+0x70/0x70
[   35.089031]  ? rawv6_sendmsg+0x1446/0x17e0
[   35.090309]  ? entry_SYSCALL_64+0x6/0x15
[   35.091536]  validate_xmit_xfrm+0x4bf/0x5c0
[   35.092821]  __dev_queue_xmit+0x3ec/0x1360
[   35.094281]  ? netdev_core_pick_tx+0x110/0x110
[   35.096114]  ? memcpy+0x39/0x60
[   35.097253]  ? eth_header+0xcd/0xf0
[   35.101540]  ? eth_commit_mac_addr_change+0x30/0x30
[   35.108664]  ? neigh_resolve_output+0x20b/0x300
[   35.111876]  ip6_finish_output2+0x65c/0xac0
[   35.114850]  ? ip6_flush_pending_frames+0x60/0x60
[   35.117358]  ? xfrm6_output+0x96/0x190
[   35.119453]  ? ip6_send_skb+0x46/0xc0
[   35.121297]  ? ipv6_skip_exthdr+0xa9/0x240
[   35.123610]  ? ipv6_find_tlv+0x100/0x100
[   35.125402]  ? ip6_mtu+0x7b/0xc0
[   35.126787]  ? __ip6_finish_output+0x190/0x420
[   35.128072]  ip6_output+0x115/0x220
[   35.128473]  ? ip6_finish_output+0x10/0x10
[   35.128922]  ? calipso_req_setattr+0x154/0x160
[   35.129406]  ? __ip6_finish_output+0x420/0x420
[   35.129833]  ? xfrm_replay_overflow+0x546/0x8b0
[   35.130292]  ? __skb_ext_alloc+0x15/0x50
[   35.130729]  ? ip6_find_1stfragopt+0x85/0x120
[   35.131224]  xfrm_output_resume+0xf82/0x1ca0
[   35.131712]  ? kasan_remove_zero_shadow+0x1f0/0x680
[   35.132292]  ? xfrm_inner_extract_output+0xc70/0xc70
[   35.133492]  ? __skb_ext_alloc+0x42/0x50
[   35.134619]  ? memset+0x20/0x40
[   35.135643]  ? secpath_set+0xa0/0xc0
[   35.136695]  ? xfrm_output+0x103/0x510
[   35.137811]  xfrm6_output+0x96/0x190
[   35.138874]  ? xfrm6_local_error+0x180/0x180
[   35.139566]  ? xfrm6_local_rxpmtu+0x130/0x130
[   35.140034]  ip6_send_skb+0x46/0xc0
[   35.140391]  rawv6_sendmsg+0x1446/0x17e0
[   35.140814]  ? rawv6_setsockopt+0x2b0/0x2b0
[   35.141241]  ? aa_profile_af_perm+0x1b0/0x1b0
[   35.141731]  ? stack_access_ok+0x3a/0x90
[   35.142162]  ? kasan_unpoison+0x23/0x50
[   35.142584]  ? rmqueue_bulk+0x454/0x760
[   35.143008]  ? queued_spin_lock_slowpath+0x1ed/0x420
[   35.143557]  ? osq_unlock+0xf0/0xf0
[   35.143933]  ? inet_send_prepare+0x1b/0x100
[   35.144398]  ? inet_send_prepare+0x100/0x100
[   35.144859]  ? sock_sendmsg+0x8f/0xa0
[   35.145316]  sock_sendmsg+0x8f/0xa0
[   35.145697]  ____sys_sendmsg+0x347/0x3e0
[   35.146099]  ? kernel_sendmsg+0x30/0x30
[   35.146531]  ? __copy_msghdr_from_user+0x250/0x250
[   35.147051]  ? _raw_spin_unlock_irqrestore+0x12/0x30
[   35.147599]  ? __wake_up_common+0x230/0x230
[   35.148056]  ? mutex_trylock+0xc5/0x140
[   35.148479]  ___sys_sendmsg+0xe0/0x140
[   35.148906]  ? sendmsg_copy_msghdr+0x30/0x30
[   35.149407]  ? ldsem_up_read+0x13/0x40
[   35.149926]  ? file_tty_write.isra.0+0x32c/0x440
[   35.150449]  ? new_sync_write+0x276/0x370
[   35.150888]  ? __fsnotify_parent+0x3d1/0x4e0
[   35.151374]  ? __fget_files+0xc6/0x100
[   35.152023]  ? __fget_light+0xd9/0xf0
[   35.152549]  __sys_sendmsg+0xb3/0x130
[   35.152937]  ? __sys_sendmsg_sock+0x20/0x20
[   35.153373]  ? ksys_write+0x1/0x150
[   35.153771]  ? fpregs_assert_state_consistent+0x52/0x60
[   35.154423]  ? exit_to_user_mode_prepare+0x35/0x150
[   35.155033]  do_syscall_64+0x3b/0x90
[   35.155452]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   35.155974] RIP: 0033:0x49aa0d
[   35.156406] Code: c3 e8 f7 32 00 00 0f 1f 80 00 00 00 00 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 8
[   35.158752] RSP: 002b:000000000065aca8 EFLAGS: 00000206 ORIG_RAX: 000000000000002e
[   35.159674] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 000000000049aa0d
[   35.160406] RDX: 0000000000000000 RSI: 000000000065acf0 RDI: 0000000000000007
[   35.161137] RBP: 000000000065ad30 R08: 000000000000000e R09: 0000000000000000
[   35.161901] R10: 0000000000000011 R11: 0000000000000206 R12: 000000000042b3c0
[   35.162686] R13: 0000000000000000 R14: 0000000000537018 R15: 0000000000000000
[   35.163583] 
[   35.163867] Allocated by task 1978:
[   35.164292]  kasan_save_stack+0x1b/0x40
[   35.164801]  __kasan_slab_alloc+0x61/0x80
[   35.165255]  kmem_cache_alloc+0xc3/0x1f0
[   35.165668]  getname_flags+0x70/0x2a0
[   35.166312]  user_path_at_empty+0x23/0x50
[   35.166892]  path_setxattr+0x94/0x150
[   35.167279]  __x64_sys_setxattr+0x68/0x80
[   35.167700]  do_syscall_64+0x3b/0x90
[   35.168049]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   35.168547] 
[   35.168709] Freed by task 1978:
[   35.169019]  kasan_save_stack+0x1b/0x40
[   35.169385]  kasan_set_track+0x1c/0x30
[   35.169746]  kasan_set_free_info+0x20/0x30
[   35.170156]  __kasan_slab_free+0xea/0x120
[   35.170617]  kmem_cache_free+0x77/0x280
[   35.171055]  user_path_at_empty+0x45/0x50
[   35.171461]  path_setxattr+0x94/0x150
[   35.171831]  __x64_sys_setxattr+0x68/0x80
[   35.172235]  do_syscall_64+0x3b/0x90
[   35.172594]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   35.173202] 
[   35.173359] The buggy address belongs to the object at ffff888023958000
[   35.173359]  which belongs to the cache names_cache of size 4096
[   35.174624] The buggy address is located 0 bytes inside of
[   35.174624]  4096-byte region [ffff888023958000, ffff888023959000)
[   35.175801] The buggy address belongs to the page:
[   35.176266] page:0000000058de0ca0 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x23958
[   35.177193] head:0000000058de0ca0 order:3 compound_mapcount:0 compound_pincount:0
[   35.177984] flags: 0x100000000010200(slab|head|node=0|zone=1)
[   35.178612] raw: 0100000000010200 0000000000000000 dead000000000122 ffff888005a6e000
[   35.179443] raw: 0000000000000000 0000000000070007 00000001ffffffff 0000000000000000
[   35.180262] page dumped because: kasan: bad access detected
[   35.180865] 
[   35.181099] Memory state around the buggy address:
[   35.181612]  ffff888023957f00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   35.182415]  ffff888023957f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   35.183280] >ffff888023958000: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   35.184121]                    ^
[   35.184495]  ffff888023958080: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   35.185294]  ffff888023958100: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   35.186101] ==================================================================