[   16.112739] ==================================================================
[   16.113122] BUG: KASAN: use-after-free in vid_cap_buf_queue+0xa2/0xc0
[   16.113446] Write of size 8 at addr ffff88800bc723a8 by task poc/1135
[   16.113762] 
[   16.113843] CPU: 0 PID: 1135 Comm: poc Tainted: G        W         5.15.0-detector-kasan #1
[   16.114253] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   16.114658] Call Trace:
[   16.114783]  dump_stack_lvl+0x34/0x44
[   16.114969]  print_address_description.constprop.0+0x21/0x140
[   16.115270]  ? vid_cap_buf_queue+0xa2/0xc0
[   16.115497]  ? vid_cap_buf_queue+0xa2/0xc0
[   16.115718]  kasan_report.cold+0x83/0xdf
[   16.115925]  ? vid_cap_buf_queue+0xa2/0xc0
[   16.116138]  vid_cap_buf_queue+0xa2/0xc0
[   16.116340]  vb2_start_streaming+0x3c/0x1d0
[   16.116551]  vb2_core_streamon+0xad/0x100
[   16.116752]  __vb2_init_fileio+0x42c/0x460
[   16.116958]  __vb2_perform_fileio+0x5ef/0x6c0
[   16.117179]  ? _raw_spin_lock+0x7a/0xd0
[   16.117378]  ? vb2_core_dqbuf+0x740/0x740
[   16.117581]  ? __mutex_lock_interruptible_slowpath+0x10/0x10
[   16.117864]  ? __fsnotify_update_child_dentry_flags+0x1a0/0x1a0
[   16.118177]  vb2_fop_read+0x111/0x1b0
[   16.118368]  v4l2_read+0x113/0x130
[   16.118547]  vfs_read+0xc8/0x260
[   16.118716]  ksys_read+0xb9/0x150
[   16.118885]  ? vfs_write+0x390/0x390
[   16.119082]  ? fpregs_assert_state_consistent+0x52/0x60
[   16.119369]  ? exit_to_user_mode_prepare+0x35/0x150
[   16.119619]  do_syscall_64+0x3b/0x90
[   16.119802]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   16.120057] RIP: 0033:0x7fc87584008c
[   16.120272] Code: ec 28 48 89 54 24 18 48 89 74 24 10 89 7c 24 08 e8 89 fc ff ff 48 8b 54 24 18 48 8b 74 24 10 41 89 c0 8b 7c 24 08 31 c0 0f 05 <48> 3d 00 f0 ff ff 8
[   16.121529] RSP: 002b:00007fc874663e00 EFLAGS: 00000246 ORIG_RAX: 0000000000000000
[   16.122156] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fc87584008c
[   16.122752] RDX: 0000000000fffded RSI: 00007fc874665000 RDI: 0000000000000003
[   16.123296] RBP: 00007fc874663ef0 R08: 0000000000000000 R09: 0000000000000009
[   16.123758] R10: 0000000000000000 R11: 0000000000000246 R12: 00007fffbb532ece
[   16.124229] R13: 00007fffbb532ecf R14: 00007fc874663fc0 R15: 0000000000802000
[   16.124675] 
[   16.124759] Allocated by task 1136:
[   16.125001]  kasan_save_stack+0x1b/0x40
[   16.125236]  __kasan_kmalloc+0x7c/0x90
[   16.125439]  __vb2_queue_alloc+0xa6/0x690
[   16.125681]  vb2_core_reqbufs+0x40f/0x610
[   16.125946]  __vb2_init_fileio+0x179/0x460
[   16.126154]  __vb2_perform_fileio+0x5ef/0x6c0
[   16.126390]  vb2_fop_read+0x111/0x1b0
[   16.126616]  v4l2_read+0x113/0x130
[   16.126805]  vfs_read+0xc8/0x260
[   16.126971]  ksys_read+0xb9/0x150
[   16.127161]  do_syscall_64+0x3b/0x90
[   16.127363]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   16.127765] 
[   16.127902] Freed by task 1135:
[   16.128157]  kasan_save_stack+0x1b/0x40
[   16.128462]  kasan_set_track+0x1c/0x30
[   16.128762]  kasan_set_free_info+0x20/0x30
[   16.129030]  __kasan_slab_free+0xea/0x120
[   16.129290]  kfree+0x90/0x220
[   16.129484]  __vb2_queue_free+0x27b/0x370
[   16.129747]  vb2_core_reqbufs+0x146/0x610
[   16.130007]  __vb2_cleanup_fileio+0x72/0x90
[   16.130281]  vb2_core_queue_release+0x17/0x50
[   16.130563]  _vb2_fop_release+0xe8/0x110
[   16.130834]  v4l2_release+0x116/0x190
[   16.131083]  __fput+0x104/0x400
[   16.131309]  task_work_run+0x97/0xd0
[   16.131552]  exit_to_user_mode_prepare+0x14d/0x150
[   16.131869]  syscall_exit_to_user_mode+0x1d/0x40
[   16.132179]  do_syscall_64+0x48/0x90
[   16.132420]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   16.132752] 
[   16.132857] The buggy address belongs to the object at ffff88800bc72000
[   16.132857]  which belongs to the cache kmalloc-1k of size 1024
[   16.133693] The buggy address is located 936 bytes inside of
[   16.133693]  1024-byte region [ffff88800bc72000, ffff88800bc72400)
[   16.134492] The buggy address belongs to the page:
[   16.134809] page:000000003dd1fc5c refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xbc70
[   16.135436] head:000000003dd1fc5c order:3 compound_mapcount:0 compound_pincount:0
[   16.135952] flags: 0x100000000010200(slab|head|node=0|zone=1)
[   16.136373] raw: 0100000000010200 0000000000000000 dead000000000122 ffff888005841dc0
[   16.136893] raw: 0000000000000000 0000000000100010 00000001ffffffff 0000000000000000
[   16.137440] page dumped because: kasan: bad access detected
[   16.137819] 
[   16.137922] Memory state around the buggy address:
[   16.138232]  ffff88800bc72280: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   16.138723]  ffff88800bc72300: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   16.139261] >ffff88800bc72380: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   16.139789]                                   ^
[   16.140117]  ffff88800bc72400: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   16.140623]  ffff88800bc72480: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   16.141136] ==================================================================
[   16.141659] Disabling lock debugging due to kernel taint
[   16.145402] BUG: kernel NULL pointer dereference, address: 0000000000000000
[   16.145919] #PF: supervisor write access in kernel mode
[   16.146295] #PF: error_code(0x0002) - not-present page
[   16.146710] PGD 0 P4D 0 
[   16.146892] Oops: 0002 [#1] SMP KASAN
[   16.147214] CPU: 0 PID: 1139 Comm: vivid-000-vid-c Tainted: G    B   W         5.15.0-detector-kasan #1
[   16.148013] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   16.148655] RIP: 0010:memcpy_orig+0x29/0x10f
[   16.148940] Code: 00 48 89 f8 48 83 fa 20 72 7e 40 38 fe 7c 35 48 83 ea 20 48 83 ea 20 4c 8b 06 4c 8b 4e 08 4c 8b 56 10 4c 8b 5e 18 48 8d 76 20 <4c> 89 07 4c 89 4f 3
[   16.150149] RSP: 0018:ffff888008e07978 EFLAGS: 00010206
[   16.150545] RAX: 0000000000000000 RBX: 0000000000000001 RCX: ffffffff81fb02d0
[   16.151039] RDX: 00000000000004c0 RSI: ffffc90000081020 RDI: 0000000000000000
[   16.151642] RBP: ffffc90000081000 R08: 80b380b380b380b3 R09: 80b380b380b380b3
[   16.152264] R10: 80b380b380b380b3 R11: 80b380b380b380b3 R12: ffffc90000081000
[   16.152755] R13: ffff8880096d6800 R14: 0000000000000000 R15: 0000000000000000
[   16.153235] FS:  0000000000000000(0000) GS:ffff888036200000(0000) knlGS:0000000000000000
[   16.153881] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   16.154289] CR2: 0000000000000000 CR3: 000000000a8c8000 CR4: 00000000000006f0
[   16.154759] Call Trace:
[   16.154930]  tpg_fill_plane_buffer+0x6c0/0x14f0
[   16.155312]  vivid_fillbuff+0xe06/0x1ae0
[   16.155610]  ? __switch_to_asm+0x50/0x70
[   16.155890]  ? vivid_grab_controls+0x160/0x160
[   16.156201]  ? __update_load_avg_cfs_rq+0x52/0x550
[   16.156528]  ? update_load_avg+0x5a6/0xb20
[   16.156825]  ? rb_insert_color+0x1f9/0x320
[   16.157111]  ? _raw_spin_lock+0x7a/0xd0
[   16.157384]  ? _raw_read_lock_irq+0x30/0x30
[   16.157678]  ? vivid_thread_vid_cap_tick+0x5f2/0xdb0
[   16.157937]  vivid_thread_vid_cap_tick+0x5f2/0xdb0
[   16.158241]  ? mutex_lock+0xce/0xe0
[   16.158497]  ? __mutex_lock_slowpath+0x10/0x10
[   16.158765]  vivid_thread_vid_cap+0x2db/0x490
[   16.159051]  ? vivid_thread_vid_cap_tick+0xdb0/0xdb0
[   16.159359]  kthread+0x1d2/0x200
[   16.159576]  ? set_kthread_struct+0x80/0x80
[   16.159838]  ret_from_fork+0x22/0x30
[   16.160062] Modules linked in:
[   16.160264] CR2: 0000000000000000
[   16.160486] ---[ end trace c29ce09a8aedb6a8 ]---
[   16.160787] RIP: 0010:memcpy_orig+0x29/0x10f
[   16.161109] Code: 00 48 89 f8 48 83 fa 20 72 7e 40 38 fe 7c 35 48 83 ea 20 48 83 ea 20 4c 8b 06 4c 8b 4e 08 4c 8b 56 10 4c 8b 5e 18 48 8d 76 20 <4c> 89 07 4c 89 4f 3
[   16.162285] RSP: 0018:ffff888008e07978 EFLAGS: 00010206
[   16.162639] RAX: 0000000000000000 RBX: 0000000000000001 RCX: ffffffff81fb02d0
[   16.163023] RDX: 00000000000004c0 RSI: ffffc90000081020 RDI: 0000000000000000
[   16.163504] RBP: ffffc90000081000 R08: 80b380b380b380b3 R09: 80b380b380b380b3
[   16.163940] R10: 80b380b380b380b3 R11: 80b380b380b380b3 R12: ffffc90000081000
[   16.164414] R13: ffff8880096d6800 R14: 0000000000000000 R15: 0000000000000000
[   16.164834] FS:  0000000000000000(0000) GS:ffff888036200000(0000) knlGS:0000000000000000
[   16.165349] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   16.165821] CR2: 0000000000000000 CR3: 000000000a8c8000 CR4: 00000000000006f0