[   18.334902] ==================================================================
[   18.335464] BUG: KASAN: use-after-free in route4_get+0x7d/0xc0
[   18.335874] Read of size 4 at addr ffff888008240d40 by task poc/1133
[   18.336666] 
[   18.337025] CPU: 0 PID: 1133 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   18.338605] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   18.340432] Call Trace:
[   18.340988]  dump_stack_lvl+0x34/0x44
[   18.341841]  print_address_description.constprop.0+0x21/0x140
[   18.343031]  ? route4_get+0x7d/0xc0
[   18.343386]  ? route4_get+0x7d/0xc0
[   18.343738]  kasan_report.cold+0x83/0xdf
[   18.344170]  ? __mutex_unlock_slowpath.isra.0+0x1d0/0x210
[   18.344732]  ? route4_get+0x7d/0xc0
[   18.345110]  route4_get+0x7d/0xc0
[   18.345496]  tc_get_tfilter+0x458/0x750
[   18.345921]  ? u32_change+0x13c0/0x13c0
[   18.346357]  ? tfilter_notify+0x170/0x170
[   18.346971]  ? __alloc_skb+0x19b/0x230
[   18.347467]  ? __alloc_pages+0x246/0x400
[   18.347883]  ? __alloc_pages_slowpath.constprop.0+0x1160/0x1160
[   18.348440]  ? ____sys_sendmsg+0x347/0x3e0
[   18.348994]  ? tfilter_notify+0x170/0x170
[   18.349500]  rtnetlink_rcv_msg+0x454/0x520
[   18.349940]  ? policy_nodemask+0x1a/0xa0
[   18.350334]  ? rtnl_calcit.isra.0+0x1e0/0x1e0
[   18.350747]  ? __kasan_init_slab_obj+0x21/0x30
[   18.351171]  ? setup_object.isra.0+0x17/0x90
[   18.351584]  ? new_slab+0x16f/0x2c0
[   18.352011]  netlink_rcv_skb+0x15c/0x1f0
[   18.352439]  ? rtnl_calcit.isra.0+0x1e0/0x1e0
[   18.352874]  ? netlink_ack+0x4e0/0x4e0
[   18.353290]  ? netlink_deliver_tap+0x4d/0x3c0
[   18.353772]  netlink_unicast+0x2d8/0x3d0
[   18.354190]  ? netlink_attachskb+0x400/0x400
[   18.354599]  ? is_bpf_text_address+0x13/0x20
[   18.355288]  ? kernel_text_address+0xf3/0x100
[   18.355909]  netlink_sendmsg+0x398/0x680
[   18.356455]  ? netlink_unicast+0x3d0/0x3d0
[   18.357034]  ? iovec_from_user+0x12e/0x1a0
[   18.357618]  ? netlink_unicast+0x3d0/0x3d0
[   18.358333]  sock_sendmsg+0x96/0xa0
[   18.358779]  ____sys_sendmsg+0x347/0x3e0
[   18.361455]  ? kernel_sendmsg+0x30/0x30
[   18.362019]  ? __copy_msghdr_from_user+0x250/0x250
[   18.362574]  ? do_syscall_64+0x3b/0x90
[   18.363020]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[   18.363587]  ? __schedule+0x582/0xf30
[   18.363965]  ? __alloc_pages+0x246/0x400
[   18.364384]  ___sys_sendmsg+0xe0/0x140
[   18.364788]  ? sendmsg_copy_msghdr+0x30/0x30
[   18.365232]  ? _raw_spin_lock+0x7a/0xd0
[   18.365608]  ? pagevec_add_and_need_flush+0x85/0xa0
[   18.366145]  ? lru_cache_add+0x5d/0x80
[   18.366515]  ? __handle_mm_fault+0x9dc/0x1190
[   18.366944]  ? __pmd_alloc+0x250/0x250
[   18.367366]  ? _raw_spin_lock+0x7a/0xd0
[   18.367772]  ? __fget_light+0x9e/0xf0
[   18.368204]  __sys_sendmsg+0xb3/0x130
[   18.368593]  ? __sys_sendmsg_sock+0x20/0x20
[   18.369021]  ? do_user_addr_fault+0x27b/0x850
[   18.369537]  ? asm_exc_page_fault+0x8/0x30
[   18.369994]  ? fpregs_assert_state_consistent+0x52/0x60
[   18.370565]  do_syscall_64+0x3b/0x90
[   18.370950]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   18.371483] RIP: 0033:0x7fcec9d702c3
[   18.371944] Code: 64 89 02 48 c7 c0 ff ff ff ff eb b7 66 2e 0f 1f 84 00 00 00 00 00 90 64 8b 04 25 18 00 00 00 85 c0 75 14 b8 2e 00 00 00 0f 05 <48> 3d 00 f0 ff ff 8
[   18.373923] RSP: 002b:00007ffd76552798 EFLAGS: 00000246 ORIG_RAX: 000000000000002e
[   18.374787] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fcec9d702c3
[   18.375613] RDX: 0000000000000000 RSI: 00007ffd765527b0 RDI: 0000000000000003
[   18.376318] RBP: 00007ffd76552840 R08: 0000000000000004 R09: 00007fcec9e2fbe0
[   18.377025] R10: 0000000000000070 R11: 0000000000000246 R12: 0000559f77a00200
[   18.377715] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
[   18.378459] 
[   18.378665] Allocated by task 1133:
[   18.379070]  kasan_save_stack+0x1b/0x40
[   18.379448]  __kasan_kmalloc+0x7c/0x90
[   18.379819]  route4_change+0x18f/0xde0
[   18.380214]  tc_new_tfilter+0x51a/0xfb0
[   18.380629]  rtnetlink_rcv_msg+0x454/0x520
[   18.381045]  netlink_rcv_skb+0x15c/0x1f0
[   18.381482]  netlink_unicast+0x2d8/0x3d0
[   18.381898]  netlink_sendmsg+0x398/0x680
[   18.382298]  sock_sendmsg+0x96/0xa0
[   18.382658]  ____sys_sendmsg+0x347/0x3e0
[   18.383059]  ___sys_sendmsg+0xe0/0x140
[   18.383449]  __sys_sendmsg+0xb3/0x130
[   18.383813]  do_syscall_64+0x3b/0x90
[   18.384226]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   18.384748] 
[   18.384912] Freed by task 231:
[   18.385239]  kasan_save_stack+0x1b/0x40
[   18.385651]  kasan_set_track+0x1c/0x30
[   18.386079]  kasan_set_free_info+0x20/0x30
[   18.386611]  __kasan_slab_free+0xea/0x120
[   18.387090]  kfree+0x90/0x220
[   18.387447]  route4_delete_filter_work+0x17/0x20
[   18.388036]  process_one_work+0x48d/0x790
[   18.388499]  worker_thread+0x78/0x6c0
[   18.388880]  kthread+0x1d2/0x200
[   18.389254]  ret_from_fork+0x22/0x30
[   18.389632] 
[   18.389805] Last potentially related work creation:
[   18.390316]  kasan_save_stack+0x1b/0x40
[   18.390715]  kasan_record_aux_stack+0xa3/0xb0
[   18.391134]  insert_work+0x30/0x160
[   18.391481]  __queue_work+0x1fb/0x5d0
[   18.391830]  rcu_work_rcufn+0x2a/0x30
[   18.392181]  rcu_core+0x3f2/0xc90
[   18.392536]  __do_softirq+0xf6/0x355
[   18.392882] 
[   18.393032] Second to last potentially related work creation:
[   18.393584]  kasan_save_stack+0x1b/0x40
[   18.393977]  kasan_record_aux_stack+0xa3/0xb0
[   18.394474]  call_rcu+0x52/0x590
[   18.394799]  queue_rcu_work+0x44/0x50
[   18.395192]  route4_change+0xbbc/0xde0
[   18.395590]  tc_new_tfilter+0x51a/0xfb0
[   18.395971]  rtnetlink_rcv_msg+0x454/0x520
[   18.396375]  netlink_rcv_skb+0x15c/0x1f0
[   18.396818]  netlink_unicast+0x2d8/0x3d0
[   18.397226]  netlink_sendmsg+0x398/0x680
[   18.397620]  sock_sendmsg+0x96/0xa0
[   18.397975]  ____sys_sendmsg+0x347/0x3e0
[   18.398390]  ___sys_sendmsg+0xe0/0x140
[   18.398786]  __sys_sendmsg+0xb3/0x130
[   18.399174]  do_syscall_64+0x3b/0x90
[   18.399545]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   18.400053] 
[   18.400213] The buggy address belongs to the object at ffff888008240d00
[   18.400213]  which belongs to the cache kmalloc-192 of size 192
[   18.401449] The buggy address is located 64 bytes inside of
[   18.401449]  192-byte region [ffff888008240d00, ffff888008240dc0)
[   18.402613] The buggy address belongs to the page:
[   18.403102] page:000000000af214ee refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x8240
[   18.404025] flags: 0x100000000000200(slab|node=0|zone=1)
[   18.404656] raw: 0100000000000200 0000000000000000 0000000100000001 ffff888005841a00
[   18.405481] raw: 0000000000000000 0000000000100010 00000001ffffffff 0000000000000000
[   18.406287] page dumped because: kasan: bad access detected
[   18.406884] 
[   18.407055] Memory state around the buggy address:
[   18.407555]  ffff888008240c00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   18.408291]  ffff888008240c80: 00 00 fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   18.409035] >ffff888008240d00: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   18.409795]                                            ^
[   18.410355]  ffff888008240d80: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
[   18.411056]  ffff888008240e00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   18.411804] ==================================================================
[   18.412589] Disabling lock debugging due to kernel taint