[   24.550401] ==================================================================
[   24.550865] BUG: KASAN: slab-out-of-bounds in xt_compat_target_from_user.cold+0x34/0xfc
[   24.551390] Write of size 4 at addr ffff888009662ffe by task poc/1135
[   24.551734] 
[   24.551823] CPU: 0 PID: 1135 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   24.552184] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   24.552601] Call Trace:
[   24.552729]  dump_stack_lvl+0x34/0x44
[   24.552922]  print_address_description.constprop.0+0x21/0x140
[   24.553207]  ? xt_compat_target_from_user.cold+0x34/0xfc
[   24.553475]  ? xt_compat_target_from_user.cold+0x34/0xfc
[   24.553741]  kasan_report.cold+0x83/0xdf
[   24.553994]  ? xt_compat_target_from_user.cold+0x34/0xfc
[   24.554293]  kasan_check_range+0x14e/0x1b0
[   24.554543]  memset+0x20/0x40
[   24.554722]  xt_compat_target_from_user.cold+0x34/0xfc
[   24.554991]  ? xt_compat_match_from_user+0x150/0x150
[   24.555260]  ? kasan_unpoison+0x23/0x50
[   24.555454]  ? __kasan_slab_alloc+0x2c/0x80
[   24.555671]  translate_compat_table+0x80e/0xa50
[   24.555923]  ? do_ipt_get_ctl+0x480/0x480
[   24.556126]  ? qlist_free_all+0x59/0xd0
[   24.556342]  ? __srcu_read_unlock+0x1e/0x40
[   24.556604]  ? kasan_quarantine_reduce+0x176/0x1d0
[   24.556872]  ? kasan_unpoison+0x23/0x50
[   24.557082]  ? __kasan_slab_alloc+0x2c/0x80
[   24.557305]  compat_do_replace.isra.0+0x1e3/0x370
[   24.557546]  ? ipt_alloc_initial_table+0x2a0/0x2a0
[   24.557819]  ? _raw_spin_unlock_irqrestore+0x12/0x30
[   24.558110]  ? apparmor_capable+0xfd/0x2a0
[   24.558354]  ? apparmor_file_free_security+0x80/0x80
[   24.558645]  ? bpf_lsm_capset+0x10/0x10
[   24.558939]  ? security_capable+0x4d/0x60
[   24.559211]  do_ipt_set_ctl+0x457/0x5f0
[   24.559407]  ? kernel_text_address+0xf3/0x100
[   24.559633]  ? compat_do_replace.isra.0+0x370/0x370
[   24.559879]  ? mutex_unlock+0x80/0xd0
[   24.560069]  ? __mutex_unlock_slowpath.isra.0+0x210/0x210
[   24.560335]  ? mutex_unlock+0x80/0xd0
[   24.560516]  ? __mutex_unlock_slowpath.isra.0+0x210/0x210
[   24.560782]  nf_setsockopt+0x61/0x90
[   24.560976]  ip_setsockopt+0x4b7/0x19e0
[   24.561189]  ? aa_label_sk_perm+0xa4/0x290
[   24.561404]  ? ip_ra_control+0x290/0x290
[   24.561603]  ? remove_wait_queue+0x80/0xb0
[   24.561818]  ? _raw_spin_lock_irqsave+0x80/0xe0
[   24.562050]  ? _raw_write_lock_irqsave+0xe0/0xe0
[   24.562278]  ? __wake_up_common+0x52/0x230
[   24.562507]  tcp_setsockopt+0xef/0x1220
[   24.562703]  ? tcp_sock_set_keepidle+0x40/0x40
[   24.562928]  ? __alloc_pages+0x246/0x400
[   24.563146]  ? aa_sk_perm+0x128/0x350
[   24.563342]  ? aa_af_perm+0x1e0/0x1e0
[   24.563524]  ? sock_common_setsockopt+0x50/0x80
[   24.563752]  __sys_setsockopt+0x103/0x1b0
[   24.563954]  ? __ia32_sys_recv+0x60/0x60
[   24.564147]  ? __fsnotify_update_child_dentry_flags+0x1a0/0x1a0
[   24.564440]  ? __ia32_compat_sys_msgrcv+0x80/0x80
[   24.564673]  __ia32_compat_sys_socketcall+0x38a/0x450
[   24.564927]  ? __ia32_compat_sys_recvmmsg_time32+0x80/0x80
[   24.565194]  ? down_read_trylock+0xe3/0x140
[   24.565402]  ? handle_mm_fault+0x105/0x230
[   24.565621]  ? up_read+0x15/0x80
[   24.565784]  ? do_user_addr_fault+0x27b/0x850
[   24.566005]  __do_fast_syscall_32+0x6b/0xe0
[   24.566214]  do_fast_syscall_32+0x2f/0x70
[   24.566428]  entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
[   24.566709] RIP: 0023:0xf7f68549
[   24.566898] Code: 03 74 c0 01 10 05 03 74 b8 01 10 06 03 74 b4 01 10 07 03 74 b0 01 10 08 03 74 d8 01 00 00 00 00 00 51 52 55 89 e5 0f 34 cd 80 <5d> 5a 59 c3 90 90 0
[   24.567797] RSP: 002b:00000000ff9ec710 EFLAGS: 00000246 ORIG_RAX: 0000000000000066
[   24.568180] RAX: ffffffffffffffda RBX: 000000000000000e RCX: 00000000ff9ec728
[   24.568523] RDX: 00000000ff9ec77c RSI: 0000000000000000 RDI: 00000000ff9ed78c
[   24.568869] RBP: 00000000ff9ed7a8 R08: 0000000000000000 R09: 0000000000000000
[   24.569211] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
[   24.569552] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
[   24.569899] 
[   24.569980] Allocated by task 1135:
[   24.570156]  kasan_save_stack+0x1b/0x40
[   24.570357]  __kasan_kmalloc+0x7c/0x90
[   24.570541]  xt_alloc_table_info+0x2b/0x60
[   24.570743]  translate_compat_table+0x62d/0xa50
[   24.570969]  compat_do_replace.isra.0+0x1e3/0x370
[   24.571197]  do_ipt_set_ctl+0x457/0x5f0
[   24.571384]  nf_setsockopt+0x61/0x90
[   24.571559]  ip_setsockopt+0x4b7/0x19e0
[   24.571746]  tcp_setsockopt+0xef/0x1220
[   24.571937]  __sys_setsockopt+0x103/0x1b0
[   24.572132]  __ia32_compat_sys_socketcall+0x38a/0x450
[   24.572376]  __do_fast_syscall_32+0x6b/0xe0
[   24.572580]  do_fast_syscall_32+0x2f/0x70
[   24.572778]  entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
[   24.573091] 
[   24.573224] The buggy address belongs to the object at ffff888009662000
[   24.573224]  which belongs to the cache kmalloc-4k of size 4096
[   24.573983] The buggy address is located 4094 bytes inside of
[   24.573983]  4096-byte region [ffff888009662000, ffff888009663000)
[   24.574626] The buggy address belongs to the page:
[   24.574873] page:000000004321f65e refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x9660
[   24.575377] head:000000004321f65e order:3 compound_mapcount:0 compound_pincount:0
[   24.575777] flags: 0x100000000010200(slab|head|node=0|zone=1)
[   24.576105] raw: 0100000000010200 0000000000000000 dead000000000122 ffff888005842140
[   24.576548] raw: 0000000000000000 0000000080040004 00000001ffffffff 0000000000000000
[   24.576985] page dumped because: kasan: bad access detected
[   24.577305] 
[   24.577390] Memory state around the buggy address:
[   24.577652]  ffff888009662e80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   24.578057]  ffff888009662f00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   24.578518] >ffff888009662f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 06
[   24.578930]                                                                 ^
[   24.579332]  ffff888009663000: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   24.579689]  ffff888009663080: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   24.580070] ==================================================================
[   24.580515] Disabling lock debugging due to kernel taint