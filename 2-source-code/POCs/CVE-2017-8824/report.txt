[   17.341895] ==================================================================
[   17.342311] BUG: KASAN: use-after-free in ccid_hc_rx_delete+0x19/0x60
[   17.342695] Read of size 8 at addr ffff88800896f000 by task poc/1134
[   17.343064] 
[   17.343162] CPU: 1 PID: 1134 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   17.343611] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   17.344162] Call Trace:
[   17.344325]  dump_stack_lvl+0x34/0x44
[   17.344561]  print_address_description.constprop.0+0x21/0x140
[   17.344902]  ? ccid_hc_rx_delete+0x19/0x60
[   17.345140]  ? ccid_hc_rx_delete+0x19/0x60
[   17.345346]  kasan_report.cold+0x83/0xdf
[   17.345575]  ? ccid_hc_rx_delete+0x19/0x60
[   17.345815]  ccid_hc_rx_delete+0x19/0x60
[   17.346034]  dccp_destroy_sock+0x192/0x1c0
[   17.346259]  dccp_v6_destroy_sock+0xe/0x20
[   17.346502]  inet_csk_destroy_sock+0xb2/0x1f0
[   17.346752]  dccp_close+0x5ab/0x660
[   17.346930]  ? page_endio+0x1d0/0x1d0
[   17.347120]  ? dccp_done+0x80/0x80
[   17.347292]  ? down_write+0xb2/0x100
[   17.347480]  ? __down_killable+0x210/0x210
[   17.347685]  inet_release+0x75/0xc0
[   17.347864]  __sock_release+0x72/0x120
[   17.348054]  sock_close+0x11/0x20
[   17.348220]  __fput+0x104/0x400
[   17.348381]  task_work_run+0x97/0xd0
[   17.348565]  exit_to_user_mode_prepare+0x14d/0x150
[   17.348809]  syscall_exit_to_user_mode+0x1d/0x40
[   17.349069]  do_syscall_64+0x48/0x90
[   17.349314]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   17.349602] RIP: 0033:0x7f56350fa6c3
[   17.349814] Code: e9 37 ff ff ff e8 4d e0 01 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 00 64 8b 04 25 18 00 00 00 85 c0 75 14 b8 03 00 00 00 0f 05 <48> 3d 00 f0 ff ff 8
[   17.350860] RSP: 002b:00007ffc60573528 EFLAGS: 00000246 ORIG_RAX: 0000000000000003
[   17.351270] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007f56350fa6c3
[   17.351621] RDX: 0000000000000000 RSI: 0000000000000001 RDI: 0000000000000004
[   17.351971] RBP: 00007ffc60573540 R08: 00000000ffffffff R09: 0000000000000000
[   17.352320] R10: 00007f56351f6440 R11: 0000000000000246 R12: 000056390c96a0e0
[   17.352668] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
[   17.353018] 
[   17.353112] Allocated by task 1134:
[   17.353323]  kasan_save_stack+0x1b/0x40
[   17.353585]  __kasan_slab_alloc+0x61/0x80
[   17.353818]  kmem_cache_alloc+0xc3/0x1f0
[   17.354025]  ccid_new+0x98/0x1a0
[   17.354197]  dccp_hdlr_ccid+0x1d/0xa0
[   17.354390]  dccp_feat_activate_values+0x1a9/0x340
[   17.354632]  dccp_rcv_state_process+0x614/0x7b0
[   17.354859]  dccp_v6_do_rcv+0x108/0x400
[   17.355053]  __release_sock+0xd4/0x140
[   17.355250]  release_sock+0x39/0xd0
[   17.355426]  __inet_stream_connect+0x32c/0x5c0
[   17.355696]  inet_stream_connect+0x44/0x70
[   17.355904]  __sys_connect+0xeb/0x110
[   17.356193]  __x64_sys_connect+0x3e/0x50
[   17.356393]  do_syscall_64+0x3b/0x90
[   17.356582]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   17.356842] 
[   17.356923] Freed by task 1134:
[   17.357093]  kasan_save_stack+0x1b/0x40
[   17.357381]  kasan_set_track+0x1c/0x30
[   17.357594]  kasan_set_free_info+0x20/0x30
[   17.357811]  __kasan_slab_free+0xea/0x120
[   17.358020]  kmem_cache_free+0x77/0x280
[   17.358218]  dccp_hdlr_ccid+0x7c/0xa0
[   17.358399]  dccp_feat_activate_values+0x1a9/0x340
[   17.358635]  dccp_create_openreq_child+0x1ea/0x230
[   17.358882]  dccp_v6_request_recv_sock+0x131/0xa40
[   17.359119]  dccp_check_req+0x1b7/0x2f0
[   17.359310]  dccp_v6_rcv+0x31b/0xb30
[   17.359488]  ip6_protocol_deliver_rcu+0x6bc/0x820
[   17.359725]  ip6_input_finish+0x11/0x20
[   17.359915]  ip6_input+0x14b/0x160
[   17.360085]  ipv6_rcv+0x177/0x190
[   17.360252]  __netif_receive_skb_one_core+0xd9/0x130
[   17.360501]  process_backlog+0x10f/0x290
[   17.360697]  __napi_poll+0x5c/0x240
[   17.360875]  net_rx_action+0x47b/0x510
[   17.361066]  __do_softirq+0xf6/0x355
[   17.361298] 
[   17.361379] The buggy address belongs to the object at ffff88800896f000
[   17.361379]  which belongs to the cache ccid2_hc_rx_sock of size 12
[   17.362059] The buggy address is located 0 bytes inside of
[   17.362059]  12-byte region [ffff88800896f000, ffff88800896f00c)
[   17.362634] The buggy address belongs to the page:
[   17.362879] page:000000002aa0a722 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x896f
[   17.363378] flags: 0x100000000000200(slab|node=0|zone=1)
[   17.363655] raw: 0100000000000200 0000000000000000 dead000000000122 ffff888008082c80
[   17.364045] raw: 0000000000000000 0000000080550055 00000001ffffffff 0000000000000000
[   17.364433] page dumped because: kasan: bad access detected
[   17.364716] 
[   17.364797] Memory state around the buggy address:
[   17.365059]  ffff88800896ef00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   17.365423]  ffff88800896ef80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   17.365799] >ffff88800896f000: fa fb fc fc fc fc fa fb fc fc fc fc 00 04 fc fc
[   17.366162]                    ^
[   17.366342]  ffff88800896f080: fc fc fa fb fc fc fc fc fc fc fc fc fc fc fc fc
[   17.366731]  ffff88800896f100: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   17.367132] ==================================================================
[   17.367487] Disabling lock debugging due to kernel taint
[   17.367797] ==================================================================
[   17.368263] BUG: KASAN: double-free or invalid-free in dccp_destroy_sock+0x192/0x1c0
[   17.368715] 
[   17.368821] CPU: 1 PID: 1134 Comm: poc Tainted: G    B             5.15.0-detector-kasan #1
[   17.369384] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   17.369879] Call Trace:
[   17.370019]  dump_stack_lvl+0x34/0x44
[   17.370253]  print_address_description.constprop.0+0x21/0x140
[   17.370592]  ? dccp_destroy_sock+0x192/0x1c0
[   17.370865]  kasan_report_invalid_free+0x51/0x80
[   17.371136]  ? dccp_destroy_sock+0x192/0x1c0
[   17.371391]  __kasan_slab_free+0x106/0x120
[   17.371626]  ? dccp_destroy_sock+0x192/0x1c0
[   17.371889]  kmem_cache_free+0x77/0x280
[   17.372119]  dccp_destroy_sock+0x192/0x1c0
[   17.372363]  dccp_v6_destroy_sock+0xe/0x20
[   17.372618]  inet_csk_destroy_sock+0xb2/0x1f0
[   17.372855]  dccp_close+0x5ab/0x660
[   17.373078]  ? page_endio+0x1d0/0x1d0
[   17.373302]  ? dccp_done+0x80/0x80
[   17.373497]  ? down_write+0xb2/0x100
[   17.373709]  ? __down_killable+0x210/0x210
[   17.373939]  inet_release+0x75/0xc0
[   17.374139]  __sock_release+0x72/0x120
[   17.374352]  sock_close+0x11/0x20
[   17.374539]  __fput+0x104/0x400
[   17.374699]  task_work_run+0x97/0xd0
[   17.374879]  exit_to_user_mode_prepare+0x14d/0x150
[   17.375120]  syscall_exit_to_user_mode+0x1d/0x40
[   17.375380]  do_syscall_64+0x48/0x90
[   17.375584]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   17.375867] RIP: 0033:0x7f56350fa6c3
[   17.376071] Code: e9 37 ff ff ff e8 4d e0 01 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 00 64 8b 04 25 18 00 00 00 85 c0 75 14 b8 03 00 00 00 0f 05 <48> 3d 00 f0 ff ff 8
[   17.377126] RSP: 002b:00007ffc60573528 EFLAGS: 00000246 ORIG_RAX: 0000000000000003
[   17.377569] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00007f56350fa6c3
[   17.377976] RDX: 0000000000000000 RSI: 0000000000000001 RDI: 0000000000000004
[   17.378402] RBP: 00007ffc60573540 R08: 00000000ffffffff R09: 0000000000000000
[   17.378795] R10: 00007f56351f6440 R11: 0000000000000246 R12: 000056390c96a0e0
[   17.379186] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
[   17.379537] 
[   17.379616] Allocated by task 1134:
[   17.379794]  kasan_save_stack+0x1b/0x40
[   17.379992]  __kasan_slab_alloc+0x61/0x80
[   17.380196]  kmem_cache_alloc+0xc3/0x1f0
[   17.380392]  ccid_new+0x98/0x1a0
[   17.380556]  dccp_hdlr_ccid+0x1d/0xa0
[   17.380738]  dccp_feat_activate_values+0x1a9/0x340
[   17.380976]  dccp_rcv_state_process+0x614/0x7b0
[   17.381207]  dccp_v6_do_rcv+0x108/0x400
[   17.381399]  __release_sock+0xd4/0x140
[   17.381597]  release_sock+0x39/0xd0
[   17.381771]  __inet_stream_connect+0x32c/0x5c0
[   17.381992]  inet_stream_connect+0x44/0x70
[   17.382198]  __sys_connect+0xeb/0x110
[   17.382382]  __x64_sys_connect+0x3e/0x50
[   17.382578]  do_syscall_64+0x3b/0x90
[   17.382761]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   17.383027] 
[   17.383105] Freed by task 1134:
[   17.383267]  kasan_save_stack+0x1b/0x40
[   17.383460]  kasan_set_track+0x1c/0x30
[   17.383646]  kasan_set_free_info+0x20/0x30
[   17.383850]  __kasan_slab_free+0xea/0x120
[   17.384049]  kmem_cache_free+0x77/0x280
[   17.384247]  dccp_hdlr_ccid+0x7c/0xa0
[   17.384486]  dccp_feat_activate_values+0x1a9/0x340
[   17.384759]  dccp_create_openreq_child+0x1ea/0x230
[   17.385062]  dccp_v6_request_recv_sock+0x131/0xa40
[   17.385335]  dccp_check_req+0x1b7/0x2f0
[   17.385581]  dccp_v6_rcv+0x31b/0xb30
[   17.385794]  ip6_protocol_deliver_rcu+0x6bc/0x820
[   17.386056]  ip6_input_finish+0x11/0x20
[   17.386293]  ip6_input+0x14b/0x160
[   17.386493]  ipv6_rcv+0x177/0x190
[   17.386683]  __netif_receive_skb_one_core+0xd9/0x130
[   17.386965]  process_backlog+0x10f/0x290
[   17.387187]  __napi_poll+0x5c/0x240
[   17.387385]  net_rx_action+0x47b/0x510
[   17.387596]  __do_softirq+0xf6/0x355
[   17.387807] 
[   17.387901] The buggy address belongs to the object at ffff88800896f000
[   17.387901]  which belongs to the cache ccid2_hc_rx_sock of size 12
[   17.388644] The buggy address is located 0 bytes inside of
[   17.388644]  12-byte region [ffff88800896f000, ffff88800896f00c)
[   17.389295] The buggy address belongs to the page:
[   17.389594] page:000000002aa0a722 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x896f
[   17.390123] flags: 0x100000000000200(slab|node=0|zone=1)
[   17.390481] raw: 0100000000000200 0000000000000000 dead000000000122 ffff888008082c80
[   17.390909] raw: 0000000000000000 0000000080550055 00000001ffffffff 0000000000000000
[   17.391340] page dumped because: kasan: bad access detected
[   17.391638] 
[   17.391727] Memory state around the buggy address:
[   17.391963]  ffff88800896ef00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   17.392316]  ffff88800896ef80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[   17.392719] >ffff88800896f000: fa fb fc fc fc fc fa fb fc fc fc fc 00 04 fc fc
[   17.393119]                    ^
[   17.393302]  ffff88800896f080: fc fc fa fb fc fc fc fc fc fc fc fc fc fc fc fc
[   17.393724]  ffff88800896f100: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   17.394179] ==================================================================




root@syzkaller:~# [   17.398183] general protection fault, probably for non-canonical address 0xbe60001b00000197: 0000 [#1] SMP KASAN
[   17.399205] CPU: 1 PID: 0 Comm: swapper/1 Tainted: G    B             5.15.0-detector-kasan #1
[   17.400164] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   17.401070] RIP: 0010:__x86_indirect_thunk_rax+0x10/0x20
[   17.401625] Code: df 1f b8 ff cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc e8 07 00 00 00 f3 90 0f ae e8 eb f9 48 89 04 24 <c3> 66 66 2e 0f 1f 3
[   17.403472] RSP: 0018:ffff888036309e00 EFLAGS: 00010282
[   17.404054] RAX: be60001b00000197 RBX: ffff8880068387e8 RCX: ffffffff82583f49
[   17.404818] RDX: 0000000000000000 RSI: 0000000000000008 RDI: ffff888009b50800
[   17.405593] RBP: ffff888009fc0000 R08: 000000003767e03d R09: ffff888036309af4
[   17.406350] R10: ffffffff84a749b7 R11: fffffbfff094e936 R12: ffff888009b50800
[   17.407112] R13: ffff888005b9c880 R14: ffff888009b50b00 R15: ffff888005b9cc60
[   17.407771] FS:  0000000000000000(0000) GS:ffff888036300000(0000) knlGS:0000000000000000
[   17.408524] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   17.409060] CR2: 00007f38d583aa30 CR3: 0000000007764000 CR4: 00000000000006e0
[   17.409744] Call Trace:
[   17.409987]  <IRQ>
[   17.410202]  ? ccid_hc_tx_delete+0x3d/0x70
[   17.410599]  ? dccp_sk_destruct+0x29/0x50
[   17.410994]  ? __sk_destruct+0x2f/0x260
[   17.411408]  ? sock_alloc_send_skb+0x20/0x20
[   17.411863]  ? rcu_core+0x3f2/0xc90
[   17.412240]  ? call_rcu+0x590/0x590
[   17.412622]  ? __hrtimer_next_event_base+0x8c/0x130
[   17.413291]  ? ktime_get+0x4a/0xb0
[   17.413778]  ? dmar_free_hwirq+0x10/0x10
[   17.414333]  ? lapic_next_event+0x36/0x40
[   17.414879]  ? clockevents_program_event+0xd8/0x130
[   17.415537]  ? __do_softirq+0xf6/0x355
[   17.416041]  ? irq_exit_rcu+0x8b/0xb0
[   17.416540]  ? sysvec_apic_timer_interrupt+0x6f/0x90
[   17.417199]  </IRQ>
[   17.417460]  ? asm_sysvec_apic_timer_interrupt+0x12/0x20
[   17.417984]  ? __sched_text_end+0x6/0x6
[   17.418349]  ? rcu_eqs_enter.constprop.0+0x86/0xa0
[   17.418819]  ? default_idle+0x10/0x20
[   17.419224]  ? __sched_text_end+0x6/0x6
[   17.419645]  ? default_idle_call+0x58/0x140
[   17.420099]  ? do_idle+0x34b/0x3f0
[   17.420478]  ? _raw_spin_lock_irqsave+0x80/0xe0
[   17.420960]  ? arch_cpu_idle_exit+0x40/0x40
[   17.421405]  ? swake_up_locked+0x82/0x90
[   17.421835]  ? cpu_startup_entry+0x19/0x20
[   17.422293]  ? secondary_startup_64_no_verify+0xb0/0xbb
[   17.422829] Modules linked in:
[   17.423218] ---[ end trace 2c97b585b57ef357 ]---
[   17.423723] RIP: 0010:__x86_indirect_thunk_rax+0x10/0x20
[   17.424317] Code: df 1f b8 ff cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc e8 07 00 00 00 f3 90 0f ae e8 eb f9 48 89 04 24 <c3> 66 66 2e 0f 1f 3
[   17.441638] RSP: 0018:ffff888036309e00 EFLAGS: 00010282
[   17.442449] RAX: be60001b00000197 RBX: ffff8880068387e8 RCX: ffffffff82583f49
[   17.443275] RDX: 0000000000000000 RSI: 0000000000000008 RDI: ffff888009b50800
[   17.444078] RBP: ffff888009fc0000 R08: 000000003767e03d R09: ffff888036309af4
[   17.444885] R10: ffffffff84a749b7 R11: fffffbfff094e936 R12: ffff888009b50800
[   17.445865] R13: ffff888005b9c880 R14: ffff888009b50b00 R15: ffff888005b9cc60
[   17.446899] FS:  0000000000000000(0000) GS:ffff888036300000(0000) knlGS:0000000000000000
[   17.448045] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   17.449043] CR2: 00007f38d583aa30 CR3: 0000000007764000 CR4: 00000000000006e0
[   17.449989] Kernel panic - not syncing: Fatal exception in interrupt
[   17.450797] Kernel Offset: disabled
[   17.451173] ---[ end Kernel panic - not syncing: Fatal exception in interrupt ]---