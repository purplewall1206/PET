[   24.527097] ==================================================================
[   24.527491] BUG: KASAN: use-after-free in filp_close+0x21/0xa0
[   24.527779] Read of size 8 at addr ffff88800a297cb8 by task poc/1136
[   24.528102] 
[   24.528183] CPU: 0 PID: 1136 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   24.528609] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   24.529082] Call Trace:
[   24.529232]  dump_stack_lvl+0x34/0x44
[   24.529448]  print_address_description.constprop.0+0x21/0x140
[   24.529775]  ? filp_close+0x21/0xa0
[   24.529974]  ? filp_close+0x21/0xa0
[   24.530178]  kasan_report.cold+0x83/0xdf
[   24.530417]  ? filp_close+0x21/0xa0
[   24.530619]  kasan_check_range+0x14e/0x1b0
[   24.530852]  filp_close+0x21/0xa0
[   24.531047]  __x64_sys_close+0x1b/0x50
[   24.531263]  do_syscall_64+0x3b/0x90
[   24.531483]  entry_SYSCALL_64_after_hwframe+0x44/0xae
trigger: free th[   24.531788] RIP: 0033:0x7f1eb692d0f3
[   24.532183] Code: 8b 15 d9 9e 00 00 f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb b7 0f 1f 00 64 8b 04 25 18 00 00 00 85 c0 75 14 b8 03 00 00 00 0f 05 <48> 3d 00 f0 ff ff 8
[   24.533173] RSP: 002b:00007ffea3c9d178 EFLAGS: 00000246 ORIG_RAX: 0000000000000003
[   24.533612] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f1eb692d0f3
[   24.534010] RDX: 0000000000000000 RSI: 00005591de13d2a0 RDI: 0000000000000004
[   24.534443] RBP: 00007ffea3c9d190 R08: 0000000000000040 R09: 00007f1eb6913be0
[   24.534855] R10: 000000000000006f R11: 0000000000000246 R12: 00005591dc661080
[   24.535290] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
[   24.535704] 
[   24.535798] Allocated by task 1136:
e type confusion[   24.536016]  kasan_save_stack+0x1b/0x40
 fc->source a.k.[   24.536340]  __kasan_slab_alloc+0x61/0x80
[   24.536654]  kmem_cache_alloc+0xc3/0x1f0

[   24.536963]  __alloc_file+0x25/0x160
[   24.537181]  alloc_empty_file+0x41/0xc0
[   24.537397]  path_openat+0xd0/0x1830
[   24.537601]  do_filp_open+0x14b/0x1e0
[   24.537805]  do_sys_openat2+0x2f5/0x460
[   24.538013]  do_sys_open+0x8a/0xe0
[   24.538198]  do_syscall_64+0x3b/0x90
[   24.538392]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   24.538657] 
[   24.538743] Freed by task 1136:
[   24.538908]  kasan_save_stack+0x1b/0x40
[   24.539102]  kasan_set_track+0x1c/0x30
[   24.539288]  kasan_set_free_info+0x20/0x30
[   24.539491]  __kasan_slab_free+0xea/0x120
[   24.539689]  kfree+0x90/0x220
[   24.539836]  put_fs_context+0x1ac/0x280
[   24.540027]  fscontext_release+0x31/0x40
[   24.540223]  __fput+0x104/0x400
[   24.540381]  task_work_run+0x97/0xd0
[   24.540592]  exit_to_user_mode_prepare+0x14d/0x150
[   24.540867]  syscall_exit_to_user_mode+0x1d/0x40
[   24.541130]  do_syscall_64+0x48/0x90
[   24.541343]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   24.541634] 
[   24.541723] Last potentially related work creation:
[   24.542006]  kasan_save_stack+0x1b/0x40
[   24.542230]  kasan_record_aux_stack+0xa3/0xb0
[   24.542570]  call_rcu+0x52/0x590
[   24.542809]  task_work_run+0x97/0xd0
[   24.543102]  do_exit+0x5c2/0x1290
[   24.543394]  do_group_exit+0x78/0x120
[   24.543584]  __x64_sys_exit_group+0x28/0x30
[   24.543799]  do_syscall_64+0x3b/0x90
[   24.543987]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   24.544240] 
[   24.544319] Second to last potentially related work creation:
[   24.544603]  kasan_save_stack+0x1b/0x40
[   24.544805]  kasan_record_aux_stack+0xa3/0xb0
[   24.545042]  task_work_add+0x25/0xe0
[   24.545265]  fput_many+0x6f/0xc0
[   24.545491]  remove_vma+0x6d/0xa0
[   24.545722]  exit_mmap+0x172/0x320
[   24.545974]  mmput+0x51/0x150
[   24.546204]  do_exit+0x551/0x1290
[   24.546466]  do_group_exit+0x78/0x120
[   24.546724]  __x64_sys_exit_group+0x28/0x30
[   24.547034]  do_syscall_64+0x3b/0x90
[   24.547302]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   24.547636] 
[   24.547737] The buggy address belongs to the object at ffff88800a297c80
[   24.547737]  which belongs to the cache filp of size 232
[   24.548534] The buggy address is located 56 bytes inside of
[   24.548534]  232-byte region [ffff88800a297c80, ffff88800a297d68)
[   24.549355] The buggy address belongs to the page:
[   24.549704] page:000000008311deca refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0xa297
[   24.550376] flags: 0x100000000000200(slab|node=0|zone=1)
[   24.550841] raw: 0100000000000200 dead000000000100 dead000000000122 ffff888005a6e3c0
[   24.551489] raw: 0000000000000000 00000000800c000c 00000001ffffffff 0000000000000000
[   24.552028] page dumped because: kasan: bad access detected
[   24.552385] 
[   24.552493] Memory state around the buggy address:
[   24.552809]  ffff88800a297b80: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   24.553275]  ffff88800a297c00: fb fb fb fb fb fc fc fc fc fc fc fc fc fc fc fc
[   24.553739] >ffff88800a297c80: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   24.554200]                                         ^
[   24.554535]  ffff88800a297d00: fb fb fb fb fb fb fb fb fb fb fb fb fb fc fc fc
[   24.555001]  ffff88800a297d80: fc fc fc fc fc fc fc fc fa fb fb fb fb fb fb fb
[   24.555469] ==================================================================