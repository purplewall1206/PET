[   23.123149] ==================================================================
[   23.123631] BUG: KASAN: use-after-free in route4_get+0x7d/0xc0
[   23.124078] Read of size 4 at addr ffff888006358640 by task poc/1137
[   23.124520] 
[   23.124633] CPU: 1 PID: 1137 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   23.125112] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   23.125695] Call Trace:
[   23.125877]  dump_stack_lvl+0x34/0x44
[   23.126151]  print_address_description.constprop.0+0x21/0x140
[   23.126555]  ? route4_get+0x7d/0xc0
[   23.126805]  ? route4_get+0x7d/0xc0
[   23.127043]  kasan_report.cold+0x83/0xdf
[   23.127304]  ? __mutex_unlock_slowpath.isra.0+0x1d0/0x210
[   23.127684]  ? route4_get+0x7d/0xc0
[   23.127929]  route4_get+0x7d/0xc0
[   23.128163]  ? u32_change+0x13c0/0x13c0
[   23.128450]  tc_new_tfilter+0x438/0xfb0
[   23.128724]  ? is_bpf_text_address+0x13/0x20
[   23.129035]  ? tc_get_tfilter+0x750/0x750
[   23.129322]  ? __kernel_text_address+0xe/0x30
[   23.129633]  ? unwind_get_return_address+0x2f/0x50
[   23.129977]  ? arch_stack_walk+0x9e/0xf0
[   23.130293]  ? __alloc_skb+0x19b/0x230
[   23.130581]  ? bpf_lsm_capset+0x10/0x10
[   23.130877]  ? security_capable+0x4d/0x60
[   23.131168]  ? tc_get_tfilter+0x750/0x750
[   23.131427]  rtnetlink_rcv_msg+0x454/0x520
[   23.131730]  ? kmem_cache_alloc+0xb0/0x1f0
[   23.132023]  ? rtnl_calcit.isra.0+0x1e0/0x1e0
[   23.132364]  ? do_sys_openat2+0x2f5/0x460
[   23.132660]  ? do_sys_open+0x8a/0xe0
[   23.132947]  ? dqget+0x6d0/0x6d0
[   23.133192]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[   23.133594]  ? __alloc_pages_slowpath.constprop.0+0x1160/0x1160
[   23.134053]  netlink_rcv_skb+0x15c/0x1f0
[   23.134348]  ? rtnl_calcit.isra.0+0x1e0/0x1e0
[   23.134683]  ? netlink_ack+0x4e0/0x4e0
[   23.134970]  ? netlink_deliver_tap+0x4d/0x3c0
[   23.135275]  netlink_unicast+0x2d8/0x3d0
[   23.135555]  ? netlink_attachskb+0x400/0x400
[   23.135857]  ? kernel_text_address+0xf3/0x100
[   23.136144]  ? __kernel_text_address+0xe/0x30
[   23.136461]  netlink_sendmsg+0x398/0x680
[   23.136738]  ? netlink_unicast+0x3d0/0x3d0
[   23.137024]  ? iovec_from_user+0x12e/0x1a0
[   23.137317]  ? netlink_unicast+0x3d0/0x3d0
[   23.137599]  sock_sendmsg+0x96/0xa0
[   23.137849]  ____sys_sendmsg+0x347/0x3e0
[   23.138126]  ? kernel_sendmsg+0x30/0x30
[   23.138398]  ? __copy_msghdr_from_user+0x250/0x250
[   23.138732]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[   23.139105]  ? __alloc_pages_slowpath.constprop.0+0x1160/0x1160
[   23.139519]  ? restore_nameidata+0x7b/0xa0
[   23.139810]  ___sys_sendmsg+0xe0/0x140
[   23.140079]  ? sendmsg_copy_msghdr+0x30/0x30
[   23.140380]  ? expand_files+0x9b/0x340
[   23.140666]  ? __fsnotify_parent+0x3d1/0x4e0
[   23.140967]  ? copy_fd_bitmaps+0x110/0x110
[   23.141253]  ? __fsnotify_update_child_dentry_flags+0x1a0/0x1a0
[   23.141678]  ? _raw_spin_lock+0x7a/0xd0
[   23.141961]  ? kasan_set_track+0x1c/0x30
[   23.142240]  ? kasan_set_free_info+0x20/0x30
[   23.142543]  ? do_sys_openat2+0x258/0x460
[   23.142836]  ? kmem_cache_free+0x77/0x280
[   23.143141]  ? __fget_light+0x9e/0xf0
[   23.143420]  __sys_sendmsg+0xb3/0x130
[   23.143743]  ? __sys_sendmsg_sock+0x20/0x20
[   23.144096]  ? fpregs_assert_state_consistent+0x52/0x60
[   23.144569]  ? exit_to_user_mode_prepare+0x35/0x150
[   23.145005]  do_syscall_64+0x3b/0x90
[   23.145369]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   23.145753] RIP: 0033:0x7f93453c0e13
[   23.145994] Code: 8b 15 b9 91 00 00 f7 d8 64 89 02 48 c7 c0 ff ff ff ff eb b8 0f 1f 00 64 8b 04 25 18 00 00 00 85 c0 75 14 b8 2e 00 00 00 0f 05 <48> 3d 00 f0 ff ff 8
[   23.147304] RSP: 002b:00007fff07632898 EFLAGS: 00000246 ORIG_RAX: 000000000000002e
[   23.147944] RAX: ffffffffffffffda RBX: 00007f93453d6100 RCX: 00007f93453c0e13
[   23.148462] RDX: 0000000000000000 RSI: 00007fff076328c0 RDI: 000000000000000f
[   23.148960] RBP: 00007fff07632950 R08: 0000000000000004 R09: 00007f93453a6be0
[   23.149437] R10: 0000000000000070 R11: 0000000000000246 R12: 000055f662f9c330
[   23.149897] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
[   23.150366] 
[   23.150481] Allocated by task 1137:
[   23.150721]  kasan_save_stack+0x1b/0x40
[   23.150982]  __kasan_kmalloc+0x7c/0x90
[   23.151245]  route4_change+0x18f/0xde0
[   23.151499]  tc_new_tfilter+0x51a/0xfb0
[   23.151759]  rtnetlink_rcv_msg+0x454/0x520
[   23.152035]  netlink_rcv_skb+0x15c/0x1f0
[   23.152321]  netlink_unicast+0x2d8/0x3d0
[   23.152587]  netlink_sendmsg+0x398/0x680
[   23.152860]  sock_sendmsg+0x96/0xa0
[   23.153157]  ____sys_sendmsg+0x347/0x3e0
[   23.153487]  ___sys_sendmsg+0xe0/0x140
[   23.153805]  __sys_sendmsg+0xb3/0x130
[   23.154121]  do_syscall_64+0x3b/0x90
[   23.154429]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   23.154865] 
[   23.154997] Freed by task 69:
[   23.155258]  kasan_save_stack+0x1b/0x40
[   23.155523]  kasan_set_track+0x1c/0x30
[   23.155777]  kasan_set_free_info+0x20/0x30
[   23.156071]  __kasan_slab_free+0xea/0x120
[   23.156367]  kfree+0x90/0x220
[   23.156589]  route4_delete_filter_work+0x17/0x20
[   23.156947]  process_one_work+0x48d/0x790
[   23.157256]  worker_thread+0x78/0x6c0
[   23.157551]  kthread+0x1d2/0x200
[   23.157787]  ret_from_fork+0x22/0x30
[   23.158033] 
[   23.158138] Last potentially related work creation:
[   23.158483]  kasan_save_stack+0x1b/0x40
[   23.158764]  kasan_record_aux_stack+0xa3/0xb0
[   23.159061]  insert_work+0x30/0x160
[   23.159315]  __queue_work+0x1fb/0x5d0
[   23.159592]  rcu_work_rcufn+0x2a/0x30
[   23.159869]  rcu_core+0x3f2/0xc90
[   23.160129]  __do_softirq+0xf6/0x355
[   23.160413] 
[   23.160539] Second to last potentially related work creation:
[   23.160940]  kasan_save_stack+0x1b/0x40
[   23.161238]  kasan_record_aux_stack+0xa3/0xb0
[   23.161560]  call_rcu+0x52/0x590
[   23.161784]  queue_rcu_work+0x44/0x50
[   23.162075]  route4_change+0xbbc/0xde0
[   23.162412]  tc_new_tfilter+0x51a/0xfb0
[   23.162741]  rtnetlink_rcv_msg+0x454/0x520
[   23.163104]  netlink_rcv_skb+0x15c/0x1f0
[   23.163392]  netlink_unicast+0x2d8/0x3d0
[   23.163690]  netlink_sendmsg+0x398/0x680
[   23.164028]  sock_sendmsg+0x96/0xa0
[   23.164290]  ____sys_sendmsg+0x347/0x3e0
[   23.164569]  ___sys_sendmsg+0xe0/0x140
[   23.164799]  __sys_sendmsg+0xb3/0x130
[   23.165079]  do_syscall_64+0x3b/0x90
[   23.165381]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   23.165773] 
[   23.165890] The buggy address belongs to the object at ffff888006358600
[   23.165890]  which belongs to the cache kmalloc-192 of size 192
[   23.166790] The buggy address is located 64 bytes inside of
[   23.166790]  192-byte region [ffff888006358600, ffff8880063586c0)
[   23.167703] The buggy address belongs to the page:
[   23.168146] page:00000000ad33de7a refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x6358
[   23.168978] flags: 0x100000000000200(slab|node=0|zone=1)
[   23.169411] raw: 0100000000000200 ffffea000023a300 0000000300000003 ffff888005841a00
[   23.170116] raw: 0000000000000000 0000000000100010 00000001ffffffff 0000000000000000
[   23.170700] page dumped because: kasan: bad access detected
[   23.171137] 
[   23.171270] Memory state around the buggy address:
[   23.171656]  ffff888006358500: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   23.172209]  ffff888006358580: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
[   23.172840] >ffff888006358600: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   23.173367]                                            ^
[   23.173798]  ffff888006358680: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
[   23.174389]  ffff888006358700: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   23.174924] ==================================================================