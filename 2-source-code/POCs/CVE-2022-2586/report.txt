[   30.363301] ==================================================================
[   30.363704] BUG: KASAN: use-after-free in nf_tables_fill_setelem.isra.0+0x3e9/0x630
[   30.364100] Read of size 8 at addr ffff888008a6ce20 by task poc/1138
[   30.364435] 
[   30.364517] CPU: 0 PID: 1138 Comm: poc Not tainted 5.15.0-detector-kasan #1
[   30.364868] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[   30.365275] Call Trace:
[   30.365401]  dump_stack_lvl+0x34/0x44
[   30.365593]  print_address_description.constprop.0+0x21/0x140
[   30.365892]  ? nf_tables_fill_setelem.isra.0+0x3e9/0x630
[   30.366170]  ? nf_tables_fill_setelem.isra.0+0x3e9/0x630
[   30.366452]  kasan_report.cold+0x83/0xdf
[   30.366650]  ? nf_tables_fill_setelem.isra.0+0x3e9/0x630
[   30.366919]  nf_tables_fill_setelem.isra.0+0x3e9/0x630
[   30.367175]  ? _raw_spin_lock+0x7a/0xd0
[   30.367382]  ? nft_data_dump+0x100/0x100
[   30.367588]  ? _raw_spin_lock_irqsave+0x80/0xe0
[   30.367816]  ? __rhashtable_walk_find_next+0x197/0x2c0
[   30.368073]  nft_rhash_walk+0x1a6/0x250
[   30.368275]  ? nft_rhash_init+0x1e0/0x1e0
[   30.368477]  ? kasan_save_stack+0x32/0x40
[   30.368683]  ? kasan_save_stack+0x1b/0x40
[   30.368882]  ? __kasan_slab_alloc+0x61/0x80
[   30.369088]  ? netlink_dump+0x3a6/0x530
[   30.369284]  ? netlink_rcv_skb+0x80/0x1f0
[   30.369486]  ? nfnetlink_rcv+0xd7/0x1f0
[   30.369675]  ? netlink_unicast+0x2d8/0x3d0
[   30.369877]  ? netlink_sendmsg+0x398/0x680
[   30.370087]  ? sock_sendmsg+0x96/0xa0
[   30.370268]  ? __sys_sendto+0x154/0x1d0
[   30.370456]  ? __x64_sys_sendto+0x74/0x90
[   30.370653]  ? do_syscall_64+0x3b/0x90
[   30.370841]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[   30.371219]  ? kasan_save_stack+0x1b/0x40
[   30.371526]  ? kasan_set_track+0x1c/0x30
[   30.371797]  ? kasan_set_free_info+0x20/0x30
[   30.372094]  ? __kasan_slab_free+0xea/0x120
[   30.372399]  ? kfree+0x90/0x220
[   30.372634]  ? nf_tables_commit_audit_log+0x128/0x260
[   30.373014]  ? nf_tables_commit+0x599/0x1ba0
[   30.373312]  ? nfnetlink_rcv_batch+0x56d/0xad0
[   30.373623]  ? nfnetlink_rcv+0x1bb/0x1f0
[   30.373878]  ? netlink_unicast+0x2d8/0x3d0
[   30.374154]  ? netlink_sendmsg+0x398/0x680
[   30.374420]  ? sock_sendmsg+0x96/0xa0
[   30.374643]  ? __sys_sendto+0x154/0x1d0
[   30.374863]  ? __x64_sys_sendto+0x74/0x90
[   30.375121]  ? do_syscall_64+0x3b/0x90
[   30.375354]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[   30.375618]  ? nft_obj_notify+0xdf/0x220
[   30.375833]  ? memset+0x20/0x40
[   30.376042]  ? __nla_reserve+0x4c/0x60
[   30.376255]  ? memcpy+0x39/0x60
[   30.376419]  nf_tables_dump_set+0x4c0/0x710
[   30.376703]  ? memset+0x20/0x40
[   30.376932]  ? nf_tables_dump_setelem+0x50/0x50
[   30.377230]  ? nf_tables_getsetelem+0x420/0x420
[   30.377549]  ? __mutex_lock_slowpath+0x10/0x10
[   30.377857]  ? create_prof_cpu_mask+0x20/0x20
[   30.378154]  ? arch_stack_walk+0x9e/0xf0
[   30.378409]  netlink_dump+0x2d4/0x530
[   30.378655]  ? netlink_dump_done.isra.0+0x210/0x210
[   30.378975]  ? kasan_unpoison+0x23/0x50
[   30.379237]  ? __mutex_unlock_slowpath.isra.0+0x210/0x210
[   30.379602]  ? memcpy+0x39/0x60
[   30.379809]  __netlink_dump_start+0x2f5/0x3c0
[   30.380120]  nft_netlink_dump_start_rcu+0x39/0x60
[   30.380523]  nf_tables_getsetelem+0x3bd/0x420
[   30.380894]  ? nft_get_set_elem+0x460/0x460
[   30.381262]  ? nf_tables_register_hook+0x160/0x160
[   30.381707]  ? nf_tables_dump_setelem+0x50/0x50
[   30.382022]  ? nft_setelem_activate+0xe0/0xe0
[   30.382343]  ? nla_get_range_signed+0x1c0/0x1c0
[   30.382681]  ? stack_access_ok+0x3a/0x90
[   30.382996]  ? unwind_next_frame+0x8ca/0x960
[   30.383357]  ? nft_get_set_elem+0x460/0x460
[   30.383752]  nfnetlink_rcv_msg+0x3ae/0x490
[   30.384064]  ? nfnetlink_bind+0x90/0x90
[   30.384353]  ? __alloc_skb+0x19b/0x230
[   30.384618]  ? stack_trace_save+0x91/0xc0
[   30.384917]  ? stack_trace_snprint+0xb0/0xb0
[   30.385204]  ? __alloc_skb+0x19b/0x230
[   30.385508]  ? kasan_save_stack+0x32/0x40
[   30.385872]  ? kasan_save_stack+0x1b/0x40
[   30.386211]  ? __kasan_slab_alloc+0x61/0x80
[   30.386617]  ? kmem_cache_alloc_node+0xe0/0x210
[   30.387003]  ? __alloc_skb+0x19b/0x230
[   30.387309]  ? netlink_sendmsg+0x4cf/0x680
[   30.387668]  ? sock_sendmsg+0x96/0xa0
[   30.387963]  ? __sys_sendto+0x154/0x1d0
[   30.388236]  ? __x64_sys_sendto+0x74/0x90
[   30.388538]  ? do_syscall_64+0x3b/0x90
[   30.388901]  ? entry_SYSCALL_64_after_hwframe+0x44/0xae
[   30.389388]  ? arch_stack_walk+0x9e/0xf0
[   30.389715]  netlink_rcv_skb+0x15c/0x1f0
[   30.390054]  ? nfnetlink_bind+0x90/0x90
[   30.390390]  ? netlink_ack+0x4e0/0x4e0
[   30.390738]  ? stack_trace_snprint+0xb0/0xb0
[   30.391115]  ? stack_trace_save+0x91/0xc0
[   30.391443]  ? bpf_lsm_capset+0x10/0x10
[   30.391801]  ? security_capable+0x4d/0x60
[   30.392165]  nfnetlink_rcv+0xd7/0x1f0
[   30.392498]  ? nfnetlink_rcv_batch+0xad0/0xad0
[   30.392878]  ? netlink_deliver_tap+0x4d/0x3c0
[   30.393216]  netlink_unicast+0x2d8/0x3d0
[   30.393495]  ? netlink_attachskb+0x400/0x400
[   30.393787]  ? _raw_spin_lock_irqsave+0x80/0xe0
[   30.394109]  netlink_sendmsg+0x398/0x680
[   30.394371]  ? netlink_unicast+0x3d0/0x3d0
[   30.394652]  ? netlink_unicast+0x3d0/0x3d0
[   30.394933]  sock_sendmsg+0x96/0xa0
[   30.395191]  __sys_sendto+0x154/0x1d0
[   30.395459]  ? __ia32_sys_getpeername+0x50/0x50
[   30.395782]  ? aa_af_perm+0x1e0/0x1e0
[   30.396052]  ? _copy_to_user+0x3b/0x50
[   30.396370]  ? __ia32_sys_connect+0x50/0x50
[   30.396726]  ? __ia32_sys_socketpair+0x60/0x60
[   30.397096]  ? __sys_socket+0xf5/0x160
[   30.397422]  ? sched_setaffinity+0x83/0x190
[   30.397828]  ? compat_sock_ioctl+0x460/0x460
[   30.398253]  __x64_sys_sendto+0x74/0x90
[   30.398608]  do_syscall_64+0x3b/0x90
[   30.398883]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   30.399237] RIP: 0033:0x7f8f62ebf55c
[   30.399476] Code: ca f7 ff ff 44 8b 4c 24 2c 4c 8b 44 24 20 89 c5 44 8b 54 24 28 48 8b 54 24 18 b8 2c 00 00 00 48 8b 74 24 10 8b 7c 24 08 0f 05 <48> 3d 00 f0 ff ff b
[   30.400769] RSP: 002b:00007ffeb3136560 EFLAGS: 00000293 ORIG_RAX: 000000000000002c
[   30.401261] RAX: ffffffffffffffda RBX: 0000000000001000 RCX: 00007f8f62ebf55c
[   30.401733] RDX: 0000000000000034 RSI: 00007ffeb31365a0 RDI: 000000000000040f
[   30.402198] RBP: 0000000000000000 R08: 00007f8f62f06000 R09: 000000000000000c
[   30.402647] R10: 0000000000000000 R11: 0000000000000293 R12: 00007ffeb31375a0
[   30.403141] R13: 0000000000000000 R14: 0000000000001000 R15: 0000000000000000
[   30.403623] 
[   30.403733] Allocated by task 1138:
[   30.403960]  kasan_save_stack+0x1b/0x40
[   30.404243]  __kasan_kmalloc+0x7c/0x90
[   30.404490]  nft_obj_init+0xe5/0x1d0
[   30.404749]  nf_tables_newobj+0x5d2/0x990
[   30.405022]  nfnetlink_rcv_batch+0x7b9/0xad0
[   30.405310]  nfnetlink_rcv+0x1bb/0x1f0
[   30.405573]  netlink_unicast+0x2d8/0x3d0
[   30.405806]  netlink_sendmsg+0x398/0x680
[   30.406021]  sock_sendmsg+0x96/0xa0
[   30.406223]  __sys_sendto+0x154/0x1d0
[   30.406406]  __x64_sys_sendto+0x74/0x90
[   30.406600]  do_syscall_64+0x3b/0x90
[   30.406789]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   30.407049] 
[   30.407135] Freed by task 5:
[   30.407311]  kasan_save_stack+0x1b/0x40
[   30.407546]  kasan_set_track+0x1c/0x30
[   30.407762]  kasan_set_free_info+0x20/0x30
[   30.408037]  __kasan_slab_free+0xea/0x120
[   30.408337]  kfree+0x90/0x220
[   30.408556]  nf_tables_trans_destroy_work+0x373/0x3d0
[   30.408926]  process_one_work+0x48d/0x790
[   30.409174]  worker_thread+0x78/0x6c0
[   30.409403]  kthread+0x1d2/0x200
[   30.409590]  ret_from_fork+0x22/0x30
[   30.409809] 
[   30.409902] The buggy address belongs to the object at ffff888008a6ce00
[   30.409902]  which belongs to the cache kmalloc-256 of size 256
[   30.410676] The buggy address is located 32 bytes inside of
[   30.410676]  256-byte region [ffff888008a6ce00, ffff888008a6cf00)
[   30.411350] The buggy address belongs to the page:
[   30.411603] page:0000000058f836cd refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x8a6c
[   30.412072] head:0000000058f836cd order:1 compound_mapcount:0
[   30.412417] flags: 0x100000000010200(slab|head|node=0|zone=1)
[   30.412769] raw: 0100000000010200 0000000000000000 dead000000000122 ffff888005841b40
[   30.413200] raw: 0000000000000000 0000000080100010 00000001ffffffff 0000000000000000
[   30.413643] page dumped because: kasan: bad access detected
[   30.413971] 
[   30.414059] Memory state around the buggy address:
[   30.414331]  ffff888008a6cd00: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   30.414743]  ffff888008a6cd80: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   30.415156] >ffff888008a6ce00: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   30.415563]                                ^
[   30.415779]  ffff888008a6ce80: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
[   30.416157]  ffff888008a6cf00: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
[   30.416594] ==================================================================
[   30.417041] Disabling lock debugging due to kernel taint